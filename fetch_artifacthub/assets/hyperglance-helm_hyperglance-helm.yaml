---
# Source: hyperglance-helm/templates/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: "my-hyperglance-helm-httpd-ssl"
  labels:
    app: hyperglance-helm
    chart: hyperglance-helm-7.5.13
    release: "my-hyperglance-helm"
    heritage: "Helm"
stringData:
  hyperglance.crt: |
   -----BEGIN CERTIFICATE-----
   MIIDVDCCAjygAwIBAgIJAI/kNmmHcVLKMA0GCSqGSIb3DQEBCwUAMFExFDASBgNV
   BAMMC0h5cGVyZ2xhbmNlMRkwFwYDVQQKDBBIeXBlcmdsYW5jZSBJbmMuMREwDwYD
   VQQHDAhTYW4gSm9zZTELMAkGA1UEBhMCVVMwHhcNMjAxMDI5MTIyNjI5WhcNMjEx
   MTIzMTIyNjI5WjBRMRQwEgYDVQQDDAtIeXBlcmdsYW5jZTEZMBcGA1UECgwQSHlw
   ZXJnbGFuY2UgSW5jLjERMA8GA1UEBwwIU2FuIEpvc2UxCzAJBgNVBAYTAlVTMIIB
   IjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAs5/jnRTs8a2jjlvOFzq9HyD1
   WiMqkA9T/PZB+otf8k16ts5ghd0fRzLQQX9uTV/ewKoIHENYFWURhzPmrEFbYYAb
   f6pkq0nv4dl7ifCiSsg1bIGnq5ZeWXmgOT9r4j1BRmXF4sztLSVcpkFi6h/3DebU
   0T+vb/umwTHOnRIfb2nRnGabzVRI5JkIGdGQZaHahx3OPV9fIareKdsdiysy0fWD
   DULmnZTXcTzxzc62cJG0aye719f9i0Yc+uhEel377vceG7V7qEr8xmrtpUFUrsF6
   BW69jljJgocu0OnfrHHLL9ZH1tZW36f8P/bP72cQk3169nXFDOpGfKoLUdjfPQID
   AQABoy8wLTAWBgNVHREEDzANggtIeXBlcmdsYW5jZTATBgNVHSUEDDAKBggrBgEF
   BQcDATANBgkqhkiG9w0BAQsFAAOCAQEACOyJoCXQNHld/Feba433mq39a+CR1rqX
   KIF8EusJshQSn1rFIU5khhnmOQMAOb2xFpp5656nFA/fsMXvsUzDlNm0G3NdGERG
   svqwpfHPFtQdyjwFtV8CmPB/DacJgc5PGuYuVm8JzYa2SleqQl0ehw9r38F87ktV
   Ycdg0ykAVphT+d2CknH+MXBXpQRpG1KGiL1EKOqvay4fgFFklHpG2NxLNMC4eCCf
   XE71KPpeNy5sXH24j0c5eFmfIJ+Ce+CdMxvlQvOU0WB6pNfzwo80n7Gv8HZJcvBk
   Uik8Pm8rGh65JyaXkpp4AeOZpoeDYjht7DFF344WUu0T6+D/s4jz+A==
   -----END CERTIFICATE-----
  hyperglance.key: |
   -----BEGIN PRIVATE KEY-----
   MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCzn+OdFOzxraOO
   W84XOr0fIPVaIyqQD1P89kH6i1/yTXq2zmCF3R9HMtBBf25NX97AqggcQ1gVZRGH
   M+asQVthgBt/qmSrSe/h2XuJ8KJKyDVsgaerll5ZeaA5P2viPUFGZcXizO0tJVym
   QWLqH/cN5tTRP69v+6bBMc6dEh9vadGcZpvNVEjkmQgZ0ZBlodqHHc49X18hqt4p
   2x2LKzLR9YMNQuadlNdxPPHNzrZwkbRrJ7vX1/2LRhz66ER6Xfvu9x4btXuoSvzG
   au2lQVSuwXoFbr2OWMmChy7Q6d+sccsv1kfW1lbfp/w/9s/vZxCTfXr2dcUM6kZ8
   qgtR2N89AgMBAAECggEAPPSlaUkQn3MtbcH5zihAxa+Jk20bpIePGOj4uu1RQgjI
   /ABNASBo3OCBi7iS1e8SyI7q8axo19nUeO1D+nCzcgLnUgug3f/ZR+tl4QmoCXin
   qIrXO4NrwTFlDghXtA7Vd+5RmQWx9wAW0NSfnJP8YttSnS/feUEM9cLROrxLrqLI
   rYl/ACVrpsbgQ07sqm70/gXQiqvVO0+1hflsWLTKob0t3GEWXDnSUZPXDo4qvx0d
   57P8rpMworp1cyCqHLsqbAVlqz7QxkY40qUiJSQTCcJh/1pazaACHmaVm4dgpocm
   pCieQkFkrfGiBmU4YIm3PD1gTYX4mHylbMAiREP8AQKBgQDgd9vnnsCylkGITbsJ
   kvixEHzNiJ72JiXhtJ7d32kdHWB04DL1t2zVIm99xiyIIvtehGZh2+OlrKFzf0oE
   Y2Sy1zzWz/2HuL9r1GuxC0olEXSb6zWCpUSVuXwHYJdGsB1I1nZeV4BxucmBs/PM
   WSs+3OpyXmpGyn/a+polp1xE6QKBgQDM22Z2MF4KkA/1jO0WjdSiIZnWKBXeCLkY
   8HV/7DSaDOUs0qVGBIrtLlE4stqdY/c+o+D6jaLysNc3I7KKhoWK8ZsiRQlnK1Id
   XfIa9reNYh5SHHnCAFgqOgaA7B8Sv3adG69yZY4sD+E93JiTiyjCit9SIzULuMdE
   WvQZLwTjNQKBgGdeSuJq9QpIr3z5bryF9gh0M0TjOXDZOHCsIMzD6UADGzw3UsBc
   671q0jT1YeR/V4q7JfrCrB7LVL4/S/KhYuoIvHef6Hzr0xrxA3bQYCCZ3T1AH7A+
   M0tP05ICJSfkSlgUiwX+/aNhjy4vlIHyPjwAt+ZbHE3lSuOoq/vTCmahAoGAClCx
   5BmjYpzGcPLbrVsO7esLOAFkuH1v9JWHFR3ruCYWFB+3OsNXy4GdjWFUKMCz3m+a
   EIO5RMcqzxf5EYiciNaJnTwksRE5XUkxu7HYpEHgjPnqF5600cuCMFOzbNo/OsH+
   H6CFfCqAiQDmnedP8hvUCurC7Qgs4IBD8lCvylECgYEAqQPEEP/3iPVh+HAqLn3X
   CbZ0YOgZsE9QFmJCYmkF4f/g91PchuvV2T7ZoKqOyL+uu6z0OeoSznungujFPtSb
   MDdKyiZ79TCgFvFY5p8EZaVOKGmXVw5DOBjdfAJepG/rrgu8uIWi4MoVASqED34U
   Z2R6WaUqf1v+UMjqc404G/w=
   -----END PRIVATE KEY-----
---
# Source: hyperglance-helm/templates/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: "my-hyperglance-helm-license"
  labels:
    app: hyperglance-helm
    chart: hyperglance-helm-7.5.13
    release: "my-hyperglance-helm"
    heritage: "Helm"
stringData:
  hg.bin: Rwo4umGdlTLuVMeq6HgsqbZ1gmRbgk5z4UhCWZN2DM53aQfoQoCI/JdD1dLbEcP/MaoBdR3OaBdz/50mnvfrbhtEDGP5eWAIOmtuyLKaZoQ/ZhRnDESXtMvPznhrqpyrIwoS9uQDfpqC7xkmiof639rJUEh0VtbXbkvMjlKRKb0sKjUhD4c3HqN+tQ+n63PXAjwzk4CKMy6VrnBqUTUtgruRcztA6nVZ78DjJRWHGBheFtVvZEXxrzlzPuiRZpqbqlq8tCBtW4faIFaWTYDFVRmT4VKA2/aceI7GeARWdFg/XFfR3NYJUD3CTnEvuLbuFOs3qkp1ve3zM+uSVYw1aNl8+nDgBSi8yZnK9KQucsdLyQ7LTlDchAYrxbPmc3sZfWr+Ft7vmmM0QJ7ZvvzNtIyRH1ZX6YTiDSLb/OmTQZRREArN+hVUOaDEdcYJ1XecFeONkNKWplzIv4DfFJVtSOAVGop9+lPA5g3hUxQqNhTDA3IladRFwYRIpRgaZOBgP85Tgcyejl9YsG2gI8/cVY21GAQRxvreLkuM3PS8pUJpdOWkDQWPffGts1/aFrzyG1hZp6SiRBR7AfTDDL16abuLnNoNnbM8yB8KFc/oKTBVdtQg2ea+XyVlPNdEYW9Amm6iyM1iz74cULLl4BaFFxgnaNsWett6yM64/zbmJWTnSyqkx+hfnGW1+huhPMv7TnwarvIeKlRg8K4DmbgNWUk6KkaaJzbA3MMw695zQKMIV9detWKG81srdIe24ybCEYmYBoijDxvzQhFUQXsBJ0eU0Zp+VJbZo9TsaCH5rZGAxVhEKuMQQhaNLGJtCKO03ALBwJFCcbWRmGOyO6FhhtRYpiwbJITE/DQTVX1H5+mzmlSDlyCSIauFQTZXe7sm4S+J9z1c7qNaBnWFU3dN/uJCHU41MA/pIFqjKY3Ccb1zJDk/FCDVIdePosDEIqV5Lx/KIr6pi39kkXq+soSIGyilkLqi7JbAEw5tQU7pQ0KfXj9yHPF+LbuLQ4pLLeWb/ZGFxR+NgR8QEdj9X4UFUL5Ad66nqPSUT+RI4VewKVq4ss5HU+Uc/HdsUPI/Yll/s9vl3+gAntIHaBNb8kus9niSf4PAV2bVHPbuNcNmEz5nkrQy0Z1sJfDCKARrhqLTqzXin+cX4GJatSphu1gFHg==
---
# Source: hyperglance-helm/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: "my-hyperglance-helm-env"
  labels:
    app: hyperglance-helm
    chart: hyperglance-helm-7.5.13
    release: "my-hyperglance-helm"
    heritage: "Helm"
data:
  SAML_ENABLED: 'false'
  NON_PROXY_HOSTS: 'localhost|127.*|[::1]|169.254.169.254'
  AWS_COST_BUCKET: ''
  AWS_COST_MARKETPLACE: ''
  AWS_ENABLE_ACCESS_KEYS: ''
  MAX_HEAPSIZE: '4096m'
  RUNNING_IN: ''
  AZURE_COST_STORAGEACCOUNT: ''
  AZURE_COST_CONTAINER: ''
  URL: ''
  USE_SECMGR: 'false'
  USE_SECMGR_DEBUGGING: 'false'
  AWS_COST_USAGE_ACCOUNTS: ''
  AWS_COST_CSV_CUSTOMFORMAT_ENABLED: 'false'
  AWS_COST_CSV_FILENAME_DATE_REGEX: ''
  AWS_COST_CSV_FILENAME_DATE_PATTERN: ''
  AWS_COST_CSV_DATEFORMAT: ''
  APACHE_DISABLE_HTTPS: 'false'
---
# Source: hyperglance-helm/templates/pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: "my-hyperglance-helm-data"
  labels:
    app: hyperglance-helm
    chart: hyperglance-helm-7.5.13
    release: "my-hyperglance-helm"
    heritage: "Helm"
spec:


  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 3Gi
---
# Source: hyperglance-helm/templates/pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: "my-hyperglance-helm-postgresql-data"
  labels:
    app: hyperglance-helm
    chart: hyperglance-helm-7.5.13
    release: "my-hyperglance-helm"
    heritage: "Helm"
spec:

  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 3Gi
---
# Source: hyperglance-helm/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: hyperglance-helm
  labels:
    app: hyperglance-helm
    chart: hyperglance-helm-7.5.13
    release: "my-hyperglance-helm"
    heritage: "Helm"

spec:
  type: LoadBalancer
  ports:
    - port: 80
      targetPort: 80
      protocol: TCP
      name: http
    - port: 443
      targetPort: 443
      protocol: TCP
      name: https
    
    
    
  selector:
    app: hyperglance-helm
---
# Source: hyperglance-helm/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: hyperglance-helm
  labels:
    app: hyperglance-helm
    chart: hyperglance-helm-7.5.13
    release: "my-hyperglance-helm"
    heritage: "Helm"
    helm.sh/chart: hyperglance-helm-7.5.13
    app.kubernetes.io/name: hyperglance-helm
    app.kubernetes.io/instance: my-hyperglance-helm
    app.kubernetes.io/version: "7.5.13"
    app.kubernetes.io/managed-by: Helm
spec:
  selector:
    matchLabels:
      app: hyperglance-helm
  replicas: 1
  serviceName: "hyperglance-svc"
  template:
    metadata:
      annotations:
        timestamp: 2024-09-16T18:14:35
      labels:
        app: hyperglance-helm        
    spec:
    
    # CIS Control 5.1.5
      automountServiceAccountToken: false
    
    
      initContainers:
      - name: install
        image: busybox:latest
        
        resources:
          limits:
            cpu: null
            memory: null
          requests:
            cpu: null
            memory: null
        imagePullPolicy: "Always"
        
        command: ['sh', '-c', '[ -d /mnt/data/rules ] && chown -R 333: /mnt/data && chown root: /mnt/data/httpd_logs && chown -R 222: /var/lib/pgsql && exit 0; mkdir -p /mnt/data/httpd_logs /mnt/data/wildfly_logs /mnt/data/mellon && touch /mnt/data/email.properties && echo "mail.smtp.auth=true" > /mnt/data/email.properties && echo "mail.smtp.starttls.enable=true" >> /mnt/data/email.properties && touch /mnt/data/hg.bin && cat /mnt/license/hg.bin > /mnt/data/hg.bin && mkdir -p /mnt/data/rules && chown -R 333: /mnt/data && chown root: /mnt/data/httpd_logs && mkdir -p /var/lib/pgsql/data && mkdir -p /var/lib/pgsql/logs && chown -R 222: /var/lib/pgsql']
        
        volumeMounts:
        - name: hyperglance-data
          mountPath: /mnt/data
          readOnly: false
        - name: license
          mountPath: /mnt/license/hg.bin
          subPath: hg.bin
        
        - name: postgresql-data
          mountPath: /var/lib/pgsql
          readOnly: false
        

      containers:
      
      - name: postgresql
        image: hyperglance/postgresql:7.5.13
        
        resources:
          limits:
            cpu: null
            memory: null
          requests:
            cpu: null
            memory: null
        imagePullPolicy: "Always"
        volumeMounts:
        - name: postgresql-data
          mountPath: /var/lib/pgsql
          readOnly: false
        
      

      - name: httpd
        image: hyperglance/httpd:7.5.13
        
        resources:
          limits:
            cpu: null
            memory: null
          requests:
            cpu: null
            memory: null
        imagePullPolicy: "Always"
        envFrom:
        - configMapRef:
            name: "my-hyperglance-helm-env"
        

        volumeMounts:
        - name: httpd-ssl
          mountPath: /etc/httpd/ssl
          readOnly: true

        

        - name: hyperglance-data
          mountPath: /var/log/httpd
          subPath: httpd_logs
          readOnly: false

      - name: wildfly
        image: hyperglance/wildfly:7.5.13
        
        resources:
          limits:
            cpu: null
            memory: null
          requests:
            cpu: null
            memory: null
        imagePullPolicy: "Always"
        
        envFrom:
        - configMapRef:
            name: "my-hyperglance-helm-env"

        
        

        volumeMounts:
        - name: hyperglance-data
          mountPath: /var/lib/hyperglance/rules
          subPath: rules
          readOnly: false

        - name: hyperglance-data
          mountPath: /opt/wildfly/standalone/data/hg.bin
          subPath: hg.bin
          readOnly: false

        - name: hyperglance-data
          mountPath: /opt/wildfly/standalone/deployments/hgs.ear/lib/common.jar/email.properties
          subPath: email.properties
          readOnly: false

        # # needs to be rw to allow overwriting via webui
        # - name: license
        #   mountPath: /opt/wildfly/standalone/data/hg.bin
        #   subPath: hg.bin
        #   readOnly: false

        - name: hyperglance-data
          mountPath: /opt/wildfly/standalone/log
          subPath: wildfly_logs
          readOnly: false

      

      volumes:
      
      - name: postgresql-data
        persistentVolumeClaim:
          claimName: hyperglance-postgresql-data
      
      - name: httpd-ssl
        secret:
          
          secretName: hyperglance-httpd-ssl
          
      
      
      - name: hyperglance-data
        persistentVolumeClaim:
          claimName: hyperglance-data
      
      - name: license
        secret:
          secretName: my-hyperglance-helm-license
      restartPolicy: Always
      dnsPolicy: Default
      hostAliases:
      - ip: '127.0.0.1'
        hostnames:
        - 'httpd'
        - 'wildfly'
        - 'postgresql'
---
# Source: hyperglance-helm/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "hyperglance-helm-test-connection"
  labels:
    helm.sh/chart: hyperglance-helm-7.5.13
    app.kubernetes.io/name: hyperglance-helm
    app.kubernetes.io/instance: my-hyperglance-helm
    app.kubernetes.io/version: "7.5.13"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['hyperglance-helm:']
  restartPolicy: Never
