---
# Source: stash-enterprise/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-stash-enterprise
  namespace: default
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
---
# Source: stash-enterprise/templates/apiregistration.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-stash-enterprise-apiserver-cert
  namespace: default
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
type: Opaque
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lRZlE2LzRoZUh6MlNhYW9Yei9icVRuREFOQmdrcWhraUc5dzBCQVFzRkFEQU4KTVFzd0NRWURWUVFERXdKallUQWVGdzB5TkRBNU1UWXdPRE0xTkRWYUZ3MHpOREE1TVRRd09ETTFORFZhTUEweApDekFKQmdOVkJBTVRBbU5oTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF4MmlkCkZ1SlFOV1lyZUFOai95eHN3RnRjL2FnUFFZY2hkN3NyN3lpaFl1VzF1N3c4ajM0cFNkdnJpVjI3WmIzNUFweloKSHRvaTIyVk1qejRDdXFYY21kdE01akNrSnNnVXg5WXhWODM3N0paSzk2bFJLMmg3MWFVWjZ5Q0FWb01EVnBPdgpORmhvSGhXVG5NVFdOaE0vY1ZMWXZwZGR3MVA2M1ptQkJzNGxQYnBQU0hHVFlWbUx2a2Vlc01DU3g3ZkZJSTZRCkZMUm9qajhVMUQ2Z0w4M0dTNnVDbFc4NHRrTk9ncVpNZ2FCcGgxT2szQkFLS1ZzcmVqSVJ4ZGdKWGo0dG93V08KbkNtd0xMRXF6SUxya3dvRzZGTktBZUpmUkdiL01rcUdPa3RTaUE0TzQwZWVOc2ZWTnVFZ0Z3MENGalRDR2JGZAptZUNOMTBuSnVhU3p5OVVlRlFJREFRQUJvMkV3WHpBT0JnTlZIUThCQWY4RUJBTUNBcVF3SFFZRFZSMGxCQll3CkZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUUKRkN4VEp4eDhzbitxaXpXNFkwRGhSKzh2N0RRVE1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQnFHc2trVTUvaAoxZlJFeTNjWjZObW00Z1dHWitzSDJweWZDN01sZGRyK2ZDK0xTZUYwSCswckZXS0d1dFg3ZDRnRFFWSWYwS1FsClJOSVYvNnVhZFZFdy8rc3RuNkVmbGdQRjJhclplczBQN0MvY3BLd0Nhc3JoNVV1OXFNdFBINUFvb01wdXFuQXUKWngyVm1Kajk2MnVoOFlyTERCYVlTRHpkbFZtYndobHlpUUVtbCtZR21URmJORjA4RnFpS3ZDUXB6dVFXWXdJLwovWG85SDlNTkpIb2pzQi8rSk5DZ2dWNkZzYkVRL3YwbEZFajZyT0Y0UkI1aGJIMTUvWEdUMzlYTGJDM0huRmVsCmFrczcvbmoyVCtmcU8zZTdZYnBCWE1CRmllelQ0NG5lK1VWNjdQSGF3Q3lrSWIzSjJteVFqcVd2eDRVdmdHSUcKRjNTOExiQzJoVENkCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURZVENDQWttZ0F3SUJBZ0lSQUpUUlk2M1JFVnNBZGZaT3FWM1RjZ013RFFZSktvWklodmNOQVFFTEJRQXcKRFRFTE1Ba0dBMVVFQXhNQ1kyRXdIaGNOTWpRd09URTJNRGd6TlRRMVdoY05NelF3T1RFME1EZ3pOVFExV2pBZQpNUnd3R2dZRFZRUURFeE50ZVMxemRHRnphQzFsYm5SbGNuQnlhWE5sTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGCkFBT0NBUThBTUlJQkNnS0NBUUVBeEZQb3EvcTBGQnQ2ejVxZS83WjhlamE0OWY4QTV2SDUzeTJrSGNUZmJaQkgKMmlpTDNPaUViUWZUVXcwSzFiKzQ3Vk5vanBnaDRWRWhxK0wxZzhTeExTNFZYRzRNY04wUTZwcCtjT1gvWGo0Rgp1U1creEp2V1pOUmM1WnJoTHM3MW90SVJ4NmdIdTFmOS90Tjk1RVlGUGNIcTBONm5Uc0VBdVBVRTZFa1BvUXRnCmtZZk44NEZIZkMxL3J0RFVPTnRkLzdPanpCaTloZTRCZ1RpZGQwbzZXRlJoam8vdHVITjk3cU4zUml4RHhLczgKSXNKSlJUTU5zT25yakcrTlBIRlBZSm14c1hnczU0VmphQWFsOWpmK1liY0dMMHVGekVSSE5UdDY1NVhZOU84WApUam1DNWJZVXl4aFlFYWoxTk1TTGRIbDNDejY5cEprTXRlb0xMb3BvcVFJREFRQUJvNEdxTUlHbk1BNEdBMVVkCkR3RUIvd1FFQXdJRm9EQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRkJRY0RBUVlJS3dZQkJRVUhBd0l3REFZRFZSMFQKQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JRc1V5Y2NmTEovcW9zMXVHTkE0VWZ2TCt3MEV6QkhCZ05WSFJFRQpRREErZ2h0dGVTMXpkR0Z6YUMxbGJuUmxjbkJ5YVhObExtUmxabUYxYkhTQ0gyMTVMWE4wWVhOb0xXVnVkR1Z5CmNISnBjMlV1WkdWbVlYVnNkQzV6ZG1Nd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFCWkNmYWFtTDg3QndWWWEKMVFvTjUzTENEWWN4MjQvbG0zVGtiaS9ZdDhuenpSZEpYdW1TaFAwbDZjSmdkcmgwNEpWSnd3VkozVm5XdVdUcwpaaFFSRE1ySURlQkJ1SWxWNlhFZm8vQVZ5MmdkWkY1cHllZFVVNTZRL0EzaVJyRm1lVU5NSXNrWmZrTzl4WUFTCmtlM0YrTWwrVEZEL01hRklnZmtwbmR6M1lsWm90V1dsSmFBUWwwZXNFbVduUFJuRjZscWd2MXVWQ0pRZHdPUGoKYVRvckdrSTdoYUJMblhFcEVRSy84ekFObGhSSmRQMGxIeTRyL2Q1T1FsbFdxLzZTbjVnRFEzUE1Da3FTYmZrcwpMbmNKcFJzdmNHSjNzRHJLUUF1UUZPQ0NKR0hPU0Z3OGFqOEVhbDJ1N0hUR0NJeVdsKzQ5YUhUUkd2WXJuNEJ1CkZVcEV5VEE9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBeEZQb3EvcTBGQnQ2ejVxZS83WjhlamE0OWY4QTV2SDUzeTJrSGNUZmJaQkgyaWlMCjNPaUViUWZUVXcwSzFiKzQ3Vk5vanBnaDRWRWhxK0wxZzhTeExTNFZYRzRNY04wUTZwcCtjT1gvWGo0RnVTVysKeEp2V1pOUmM1WnJoTHM3MW90SVJ4NmdIdTFmOS90Tjk1RVlGUGNIcTBONm5Uc0VBdVBVRTZFa1BvUXRna1lmTgo4NEZIZkMxL3J0RFVPTnRkLzdPanpCaTloZTRCZ1RpZGQwbzZXRlJoam8vdHVITjk3cU4zUml4RHhLczhJc0pKClJUTU5zT25yakcrTlBIRlBZSm14c1hnczU0VmphQWFsOWpmK1liY0dMMHVGekVSSE5UdDY1NVhZOU84WFRqbUMKNWJZVXl4aFlFYWoxTk1TTGRIbDNDejY5cEprTXRlb0xMb3BvcVFJREFRQUJBb0lCQUJZbWFWL04zemROaW1PVgp6RTZKWmkzYnNxNStZTG10bjBWZ3Z0MWs4dGhIcVBPaUUzV08vakhXNmk2NmovaGhzeG1EaVk1Yzk2V1dJN2hpCjJOUlBBclpZTnF6QTljSmVEcVNKWGE2YkpGNmJuTVd3em44Y0hlb3VVM1RNTG8rN1pkZEM0Q0tvZ0liUWZLV2QKY3R5b1Vic1AvOUFrN3JkaDZ4VHkvK1M5S1hnL3YzMS9YckFLTmsvcExibko4NkhVeW9aVjRGZjJWeitWeVQ2WQpxeEpuVDhxNG03alR5ZXBLaHJxTFI1WWhCQmpZS3E3dElXMC9yWVZuYWNIVXBBUXNOQVdrb0NlcXgydmw5ZnRyCm9DNGhDejcvVG9TSk8wRU43NzVWQXFvZ1h3aGxzT0NDVmtLSllwZnpxR3RmWVFXdFZSZlE5QTNWY2xXZzZjcFgKSnpOYUN3RUNnWUVBeWRGKzZ2K1l6d3QxWUEwYWViTTZYVThDN0JnTm5PdEtYLzBHTytoeVpMMkdRTGJwZC9hdgpWOXJlNU55RkY2d1hEK2QzK0laSDdRUEs3eko1K3RDVzZtYlZWdXdpYThSZWE3bnEzVWQ5ZHIzODFPMEM5UEtTCko4YWo4QlUvRk4rT2tSZHl6NHArVGpITjBwMkM5UTE4MURYcTBqMGVkdGh6ZHdEMk1pRXFGWkVDZ1lFQStRa1AKQ3Y4N3NQQ3p4aEJncGQ1UlNmdGtZcjZ1L1RqbDhIRmRkcEpLeGw2ZC9Najh0c2FIWXFFOFhLRXF1d1h4VXZpZApEU1l4dXpIRFE4VC9yK1JEWFJaR0R0NHBabFZPcGpNa2RCSys2ZmR0QUN0Zk4yQWhCck85OEYxOGR1cm5rK3JwCkZzTXEyMlUxdkI4dy96ZDRwVVVpUjRFa2ZxUW1LS3ZaUmdia3Raa0NnWUVBdi9CL2pZNGpUWjV2TmplZ0cyaUsKdEoxbGdSYnJNM2RQVi9VempaeG4xMG1zdWpWNzI3MEFURVQ3d1p1ODlLT1ZsMm1qM3ZnT3hlcmFnUjEzaDBRRQprOC9UVElUdHc2S1J6bENXZjNiemF4QUx1cEhqUXdURVhoSDhibVEyaDJxS2s1RkNmd0lQVjl6a0RGQURjWDR2ClgwQWNJWEZCWFBSRTlFUTA0YjVLNFJFQ2dZRUFvODZWbW9Jd1hUNjJ3WDFjVlQ1YThmTHVJUldVUFBRRUs1Z20KQml4TUN4ZUpqQkVZU1pGazFEZUNZTnVTSTlyUTFlYTZSei9zVGxsNU8wYUZlTWtJbGw1a1RydExPQWk4NXcyVQoyTlRMeDFIODNMT3F1ZDM5VzA4M2pMZXhldmNneEdjc1V0Q2xqQktTdWQ4NmQyV2hjZlI3aTlVaWtEcWc3dmU2CnZ4a2hyMkVDZ1lCVFBJYUtHZnNBb3VkOTBHTnBhUE9najZhbS8vRWJpRWlWMVoxNzQ5SHlNRy8rZm5xT2xwZzkKWWxGdi9EeU41K1I5WmNQUnN5dUxvSVpNQkFWdGhTOE5EQkthbmxmeEtDd0NyRGJpTVVIU1poQzU1c2xsZm5aQwpvb3JKRHh2eGFuVEN1MWxNZWxnSGRKRkxoR3dzV1lIYWpudCs4UjljWUpaNkFxbndKb0d4emc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
---
# Source: stash-enterprise/templates/cluster-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: my-stash-enterprise
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
rules:
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs: ["*"]
- apiGroups:
  - apiregistration.k8s.io
  resources:
  - apiservices
  verbs: ["get", "patch", "delete"]
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - mutatingwebhookconfigurations
  - validatingwebhookconfigurations
  verbs: ["delete", "get", "list", "watch", "patch"]
- apiGroups:
  - stash.appscode.com
  resources:
  - "*"
  verbs: ["*"]
- apiGroups:
  - appcatalog.appscode.com
  resources:
  - "*"
  verbs: ["*"]
- apiGroups:
  - apps
  resources:
  - daemonsets
  - deployments
  - statefulsets
  verbs: ["get", "list", "watch", "patch"]
- apiGroups:
  - apps
  resources:
  - deployments
  verbs: ["create", "patch", "delete"]
- apiGroups:
  - batch
  resources:
  - jobs
  - cronjobs
  verbs: ["get", "list", "watch", "create", "delete", "patch"]
- apiGroups:
  - ""
  resources:
  - namespaces
  verbs: ["get", "list", "watch", "patch"]
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs: ["create", "update", "get", "list", "watch", "delete"]
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  verbs: ["get", "list", "watch", "create", "patch"]
- apiGroups:
  - ""
  resources:
  - services
  - endpoints
  verbs: ["get"]
- apiGroups:
  - ""
  resources:
  - secrets
  verbs: ["get", "list", "create", "patch"]
- apiGroups:
  - ""
  resources:
  - events
  verbs: ["get", "list", "create", "patch"]
- apiGroups:
  - ""
  resources:
  - nodes
  verbs: ["get", "list", "watch"]
- apiGroups:
  - ""
  resources:
  - pods
  - pods/exec
  verbs: ["get", "create", "list", "delete", "deletecollection"]
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  verbs: ["get", "create", "patch", "delete"]
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - clusterroles
  - roles
  - rolebindings
  - clusterrolebindings
  verbs: ["get","list", "create", "delete", "patch"]
- apiGroups:
  - apps.openshift.io
  resources:
  - deploymentconfigs
  verbs: ["get", "list", "watch", "patch"]
- apiGroups:
  - snapshot.storage.k8s.io
  resources:
  - volumesnapshots
  - volumesnapshotcontents
  - volumesnapshotclasses
  verbs: ["create", "get", "list", "watch", "patch", "delete"]
- apiGroups:
  - storage.k8s.io
  resources:
  - storageclasses
  verbs: ["get"]
- apiGroups:
  - coordination.k8s.io
  resources:
    - leases
  verbs: ["*"]
- apiGroups:
  - apps
  resources:
  - daemonsets/finalizers
  - deployments/finalizers
  - statefulsets/finalizers
  verbs: ["update"]
- apiGroups:
  - apps.openshift.io
  resources:
  - deploymentconfigs/finalizers
  verbs: ["update"]
- apiGroups:
  - kubedb.com
  - catalog.kubedb.com
  resources:
  - elasticsearches
  - elasticsearchversions
  verbs:
  - get
- apiGroups:
  - elasticsearch.kubedb.com
  resources:
    - elasticsearchdashboards
  verbs: ["list"]
---
# Source: stash-enterprise/templates/apiregistration.yaml
# to delegate authentication and authorization
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: my-stash-enterprise-apiserver-auth-delegator
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
roleRef:
  kind: ClusterRole
  apiGroup: rbac.authorization.k8s.io
  name: system:auth-delegator
subjects:
- kind: ServiceAccount
  name: my-stash-enterprise
  namespace: default
---
# Source: stash-enterprise/templates/cluster-role-binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: my-stash-enterprise
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: my-stash-enterprise
subjects:
- kind: ServiceAccount
  name: my-stash-enterprise
  namespace: default
---
# Source: stash-enterprise/templates/license-checker-cluster-role-binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: my-stash-enterprise-license-checker
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: appscode:license-checker
subjects:
- kind: ServiceAccount
  name: my-stash-enterprise
  namespace: default
---
# Source: stash-enterprise/templates/license-reader-cluster-role-binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: my-stash-enterprise-license-reader
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: appscode:license-reader
subjects:
- kind: ServiceAccount
  name: my-stash-enterprise
  namespace: default
---
# Source: stash-enterprise/templates/apiregistration.yaml
# to read the config for terminating authentication
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: my-stash-enterprise-apiserver-extension-server-authentication-reader
  namespace: kube-system
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
roleRef:
  kind: Role
  apiGroup: rbac.authorization.k8s.io
  name: extension-apiserver-authentication-reader
subjects:
- kind: ServiceAccount
  name: my-stash-enterprise
  namespace: default
---
# Source: stash-enterprise/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: my-stash-enterprise
  namespace: default
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
spec:
  ports:
  # Port used to expose admission webhook apiserver
  - name: api
    port: 443
    targetPort: 8443
  # Port used to expose Prometheus pushgateway
  - name: pushgateway
    port: 56789
    protocol: TCP
    targetPort: 56789
  selector:
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
---
# Source: stash-enterprise/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-stash-enterprise
  namespace: default
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: stash-enterprise
      app.kubernetes.io/instance: my-stash-enterprise
  template:
    metadata:
      labels:
        app.kubernetes.io/name: stash-enterprise
        app.kubernetes.io/instance: my-stash-enterprise
      annotations:
        checksum/apiregistration.yaml: 7786d84ff02f68c33a5776aa6e9cc25a0cee9ead8743185d56663463dae8792a
    spec:
      
      serviceAccountName: my-stash-enterprise
      containers:
      - name: operator
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsNonRoot: true
          runAsUser: 65534
        image: ghcr.io/stashed/stash-enterprise:v0.35.0
        imagePullPolicy: IfNotPresent
        args:
        - run
        - --v=3
        - --docker-registry=ghcr.io/stashed
        - --image=stash-enterprise
        - --image-tag=v0.35.0
        - --secure-port=8443
        - --authentication-configmap-namespace=kube-system
        - --audit-log-path=-
        - --tls-cert-file=/var/serving-cert/tls.crt
        - --tls-private-key-file=/var/serving-cert/tls.key
        - --pushgateway-url=http://my-stash-enterprise.default.svc:56789
        - --enable-mutating-webhook=true
        - --enable-validating-webhook=true
        - --bypass-validating-webhook-xray=false
        - --use-kubeapiserver-fqdn-for-aks=true
        - --nva-cpu=100m
        - --nva-memory=128Mi
        - --nva-user=2000
        - --nva-privileged-mode=false
        - --license-apiservice=v1beta1.admission.stash.appscode.com
        ports:
        - containerPort: 8443
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        resources:
          requests:
            cpu: 100m
        volumeMounts:
        - mountPath: /var/serving-cert
          name: serving-cert
        - mountPath: /tmp
          name: stash-scratchdir
      - name: pushgateway
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsNonRoot: true
          runAsUser: 65534
        image: 'prom/pushgateway:v1.4.2'
        imagePullPolicy: IfNotPresent
        args:
        - --web.listen-address=:56789
        - --persistence.file=/var/pv/pushgateway.dat
        resources:
          {}
        ports:
        - containerPort: 56789
        volumeMounts:
        - mountPath: /var/pv
          name: data-volume
        - mountPath: /tmp
          name: stash-scratchdir
      volumes:
      - emptyDir: {}
        name: data-volume
      - emptyDir: {}
        name: stash-scratchdir
      - name: serving-cert
        secret:
          defaultMode: 420
          secretName: my-stash-enterprise-apiserver-cert
      securityContext:
        fsGroup: 65535
      nodeSelector:
        kubernetes.io/os: linux
---
# Source: stash-enterprise/templates/apiregistration.yaml
apiVersion: apiregistration.k8s.io/v1
kind: APIService
metadata:
  name: v1alpha1.admission.stash.appscode.com
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
spec:
  group: admission.stash.appscode.com
  version: v1alpha1
  service:
    namespace: default
    name: my-stash-enterprise
  caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lRZlE2LzRoZUh6MlNhYW9Yei9icVRuREFOQmdrcWhraUc5dzBCQVFzRkFEQU4KTVFzd0NRWURWUVFERXdKallUQWVGdzB5TkRBNU1UWXdPRE0xTkRWYUZ3MHpOREE1TVRRd09ETTFORFZhTUEweApDekFKQmdOVkJBTVRBbU5oTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF4MmlkCkZ1SlFOV1lyZUFOai95eHN3RnRjL2FnUFFZY2hkN3NyN3lpaFl1VzF1N3c4ajM0cFNkdnJpVjI3WmIzNUFweloKSHRvaTIyVk1qejRDdXFYY21kdE01akNrSnNnVXg5WXhWODM3N0paSzk2bFJLMmg3MWFVWjZ5Q0FWb01EVnBPdgpORmhvSGhXVG5NVFdOaE0vY1ZMWXZwZGR3MVA2M1ptQkJzNGxQYnBQU0hHVFlWbUx2a2Vlc01DU3g3ZkZJSTZRCkZMUm9qajhVMUQ2Z0w4M0dTNnVDbFc4NHRrTk9ncVpNZ2FCcGgxT2szQkFLS1ZzcmVqSVJ4ZGdKWGo0dG93V08KbkNtd0xMRXF6SUxya3dvRzZGTktBZUpmUkdiL01rcUdPa3RTaUE0TzQwZWVOc2ZWTnVFZ0Z3MENGalRDR2JGZAptZUNOMTBuSnVhU3p5OVVlRlFJREFRQUJvMkV3WHpBT0JnTlZIUThCQWY4RUJBTUNBcVF3SFFZRFZSMGxCQll3CkZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUUKRkN4VEp4eDhzbitxaXpXNFkwRGhSKzh2N0RRVE1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQnFHc2trVTUvaAoxZlJFeTNjWjZObW00Z1dHWitzSDJweWZDN01sZGRyK2ZDK0xTZUYwSCswckZXS0d1dFg3ZDRnRFFWSWYwS1FsClJOSVYvNnVhZFZFdy8rc3RuNkVmbGdQRjJhclplczBQN0MvY3BLd0Nhc3JoNVV1OXFNdFBINUFvb01wdXFuQXUKWngyVm1Kajk2MnVoOFlyTERCYVlTRHpkbFZtYndobHlpUUVtbCtZR21URmJORjA4RnFpS3ZDUXB6dVFXWXdJLwovWG85SDlNTkpIb2pzQi8rSk5DZ2dWNkZzYkVRL3YwbEZFajZyT0Y0UkI1aGJIMTUvWEdUMzlYTGJDM0huRmVsCmFrczcvbmoyVCtmcU8zZTdZYnBCWE1CRmllelQ0NG5lK1VWNjdQSGF3Q3lrSWIzSjJteVFqcVd2eDRVdmdHSUcKRjNTOExiQzJoVENkCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  groupPriorityMinimum: 10000
  versionPriority: 15
---
# Source: stash-enterprise/templates/apiregistration.yaml
apiVersion: apiregistration.k8s.io/v1
kind: APIService
metadata:
  name: v1beta1.admission.stash.appscode.com
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
spec:
  group: admission.stash.appscode.com
  version: v1beta1
  service:
    namespace: default
    name: my-stash-enterprise
  caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lRZlE2LzRoZUh6MlNhYW9Yei9icVRuREFOQmdrcWhraUc5dzBCQVFzRkFEQU4KTVFzd0NRWURWUVFERXdKallUQWVGdzB5TkRBNU1UWXdPRE0xTkRWYUZ3MHpOREE1TVRRd09ETTFORFZhTUEweApDekFKQmdOVkJBTVRBbU5oTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF4MmlkCkZ1SlFOV1lyZUFOai95eHN3RnRjL2FnUFFZY2hkN3NyN3lpaFl1VzF1N3c4ajM0cFNkdnJpVjI3WmIzNUFweloKSHRvaTIyVk1qejRDdXFYY21kdE01akNrSnNnVXg5WXhWODM3N0paSzk2bFJLMmg3MWFVWjZ5Q0FWb01EVnBPdgpORmhvSGhXVG5NVFdOaE0vY1ZMWXZwZGR3MVA2M1ptQkJzNGxQYnBQU0hHVFlWbUx2a2Vlc01DU3g3ZkZJSTZRCkZMUm9qajhVMUQ2Z0w4M0dTNnVDbFc4NHRrTk9ncVpNZ2FCcGgxT2szQkFLS1ZzcmVqSVJ4ZGdKWGo0dG93V08KbkNtd0xMRXF6SUxya3dvRzZGTktBZUpmUkdiL01rcUdPa3RTaUE0TzQwZWVOc2ZWTnVFZ0Z3MENGalRDR2JGZAptZUNOMTBuSnVhU3p5OVVlRlFJREFRQUJvMkV3WHpBT0JnTlZIUThCQWY4RUJBTUNBcVF3SFFZRFZSMGxCQll3CkZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUUKRkN4VEp4eDhzbitxaXpXNFkwRGhSKzh2N0RRVE1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQnFHc2trVTUvaAoxZlJFeTNjWjZObW00Z1dHWitzSDJweWZDN01sZGRyK2ZDK0xTZUYwSCswckZXS0d1dFg3ZDRnRFFWSWYwS1FsClJOSVYvNnVhZFZFdy8rc3RuNkVmbGdQRjJhclplczBQN0MvY3BLd0Nhc3JoNVV1OXFNdFBINUFvb01wdXFuQXUKWngyVm1Kajk2MnVoOFlyTERCYVlTRHpkbFZtYndobHlpUUVtbCtZR21URmJORjA4RnFpS3ZDUXB6dVFXWXdJLwovWG85SDlNTkpIb2pzQi8rSk5DZ2dWNkZzYkVRL3YwbEZFajZyT0Y0UkI1aGJIMTUvWEdUMzlYTGJDM0huRmVsCmFrczcvbmoyVCtmcU8zZTdZYnBCWE1CRmllelQ0NG5lK1VWNjdQSGF3Q3lrSWIzSjJteVFqcVd2eDRVdmdHSUcKRjNTOExiQzJoVENkCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  groupPriorityMinimum: 10000
  versionPriority: 15
---
# Source: stash-enterprise/templates/apiregistration.yaml
apiVersion: apiregistration.k8s.io/v1
kind: APIService
metadata:
  name: v1alpha1.repositories.stash.appscode.com
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
spec:
  group: repositories.stash.appscode.com
  version: v1alpha1
  service:
    namespace: default
    name: my-stash-enterprise
  caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lRZlE2LzRoZUh6MlNhYW9Yei9icVRuREFOQmdrcWhraUc5dzBCQVFzRkFEQU4KTVFzd0NRWURWUVFERXdKallUQWVGdzB5TkRBNU1UWXdPRE0xTkRWYUZ3MHpOREE1TVRRd09ETTFORFZhTUEweApDekFKQmdOVkJBTVRBbU5oTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF4MmlkCkZ1SlFOV1lyZUFOai95eHN3RnRjL2FnUFFZY2hkN3NyN3lpaFl1VzF1N3c4ajM0cFNkdnJpVjI3WmIzNUFweloKSHRvaTIyVk1qejRDdXFYY21kdE01akNrSnNnVXg5WXhWODM3N0paSzk2bFJLMmg3MWFVWjZ5Q0FWb01EVnBPdgpORmhvSGhXVG5NVFdOaE0vY1ZMWXZwZGR3MVA2M1ptQkJzNGxQYnBQU0hHVFlWbUx2a2Vlc01DU3g3ZkZJSTZRCkZMUm9qajhVMUQ2Z0w4M0dTNnVDbFc4NHRrTk9ncVpNZ2FCcGgxT2szQkFLS1ZzcmVqSVJ4ZGdKWGo0dG93V08KbkNtd0xMRXF6SUxya3dvRzZGTktBZUpmUkdiL01rcUdPa3RTaUE0TzQwZWVOc2ZWTnVFZ0Z3MENGalRDR2JGZAptZUNOMTBuSnVhU3p5OVVlRlFJREFRQUJvMkV3WHpBT0JnTlZIUThCQWY4RUJBTUNBcVF3SFFZRFZSMGxCQll3CkZBWUlLd1lCQlFVSEF3RUdDQ3NHQVFVRkJ3TUNNQThHQTFVZEV3RUIvd1FGTUFNQkFmOHdIUVlEVlIwT0JCWUUKRkN4VEp4eDhzbitxaXpXNFkwRGhSKzh2N0RRVE1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQnFHc2trVTUvaAoxZlJFeTNjWjZObW00Z1dHWitzSDJweWZDN01sZGRyK2ZDK0xTZUYwSCswckZXS0d1dFg3ZDRnRFFWSWYwS1FsClJOSVYvNnVhZFZFdy8rc3RuNkVmbGdQRjJhclplczBQN0MvY3BLd0Nhc3JoNVV1OXFNdFBINUFvb01wdXFuQXUKWngyVm1Kajk2MnVoOFlyTERCYVlTRHpkbFZtYndobHlpUUVtbCtZR21URmJORjA4RnFpS3ZDUXB6dVFXWXdJLwovWG85SDlNTkpIb2pzQi8rSk5DZ2dWNkZzYkVRL3YwbEZFajZyT0Y0UkI1aGJIMTUvWEdUMzlYTGJDM0huRmVsCmFrczcvbmoyVCtmcU8zZTdZYnBCWE1CRmllelQ0NG5lK1VWNjdQSGF3Q3lrSWIzSjJteVFqcVd2eDRVdmdHSUcKRjNTOExiQzJoVENkCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  groupPriorityMinimum: 10000
  versionPriority: 15
---
# Source: stash-enterprise/templates/apiregistration.yaml
# copy kube-system/extension-apiserver-authentication into stash operator namespace
---
# Source: stash-enterprise/templates/license.yaml
# if license file is provided, then create a secret for license
---
# Source: stash-enterprise/templates/cleaner/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-stash-enterprise-cleaner
  namespace: default
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-delete-policy": hook-succeeded,hook-failed
---
# Source: stash-enterprise/templates/crd-installer/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-stash-enterprise-crd-installer
  namespace: default
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade,pre-rollback
    "helm.sh/hook-delete-policy": before-hook-creation,hook-failed
---
# Source: stash-enterprise/templates/cleaner/cluster_role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: my-stash-enterprise-cleaner
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-delete-policy": hook-succeeded,hook-failed
rules:
  - apiGroups:
      - admissionregistration.k8s.io
    resources:
      - mutatingwebhookconfigurations
      - validatingwebhookconfigurations
    verbs: ["delete"]
  - apiGroups:
      - apiregistration.k8s.io
    resources:
      - apiservices
    verbs: ["delete"]
  - apiGroups:
      - stash.appscode.com
    resources:
      - "*"
    verbs: ["delete"]
  - apiGroups:
      - batch
    resources:
      - jobs
    verbs: ["delete"]
---
# Source: stash-enterprise/templates/crd-installer/cluster_role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: my-stash-enterprise-crd-installer
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade,pre-rollback
    "helm.sh/hook-delete-policy": before-hook-creation,hook-failed
rules:
  - apiGroups:
      - apiextensions.k8s.io
    resources:
      - customresourcedefinitions
    verbs: ["*"]
  - apiGroups:
      - stash.appscode.com
    resources:
      - "*"
    verbs: ["*"]
---
# Source: stash-enterprise/templates/gerbage-collector-rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: appscode:stash:garbage-collector
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
rules:
- apiGroups:
  - policy
  verbs: ["use"]
  resources:
  - podsecuritypolicies
---
# Source: stash-enterprise/templates/license-checker-cluster-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: appscode:license-checker
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
rules:
# Get cluster id
- apiGroups:
  - ""
  resources:
  - namespaces
  verbs: ["get"]
# Issue license
- apiGroups:
  - proxyserver.licenses.appscode.com
  resources:
  - licenserequests
  verbs: ["create"]
# Detect workload/owner of operator pod
- apiGroups:
  - ""
  resources:
  - pods
  verbs: ["get"]
- apiGroups:
  - apps
  resources:
  - deployments
  - replicasets
  verbs: ["get"]
# Write events in case of license verification failure
- apiGroups:
  - ""
  resources:
  - events
  verbs: ["get", "list", "create", "patch"]
---
# Source: stash-enterprise/templates/license-reader-cluster-role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: appscode:license-reader
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
rules:
# Detect license server endpoint for stash addons
- apiGroups:
  - apiregistration.k8s.io
  resources:
  - apiservices
  verbs: ["get"]
- nonResourceURLs:
  - /appscode/license
  verbs: ["get"]
---
# Source: stash-enterprise/templates/user-roles.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: appscode:stash:edit
  labels:
    rbac.authorization.k8s.io/aggregate-to-admin: "true"
    rbac.authorization.k8s.io/aggregate-to-edit: "true"
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
rules:
- apiGroups:
  - stash.appscode.com
  - repositories.stash.appscode.com
  - appcatalog.appscode.com
  resources:
  - "*"
  verbs: ["*"]
---
# Source: stash-enterprise/templates/user-roles.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: appscode:stash:view
  labels:
    rbac.authorization.k8s.io/aggregate-to-view: "true"
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
rules:
- apiGroups:
  - stash.appscode.com
  - repositories.stash.appscode.com
  - appcatalog.appscode.com
  resources:
  - "*"
  verbs: ["get", "list", "watch"]
---
# Source: stash-enterprise/templates/cleaner/cluster_rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: my-stash-enterprise-cleaner
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-delete-policy": hook-succeeded,hook-failed
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: my-stash-enterprise-cleaner
subjects:
  - kind: ServiceAccount
    name: my-stash-enterprise-cleaner
    namespace: default
---
# Source: stash-enterprise/templates/crd-installer/cluster_rolebinding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: my-stash-enterprise-crd-installer
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade,pre-rollback
    "helm.sh/hook-delete-policy": before-hook-creation,hook-failed
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: my-stash-enterprise-crd-installer
subjects:
  - kind: ServiceAccount
    name: my-stash-enterprise-crd-installer
    namespace: default
---
# Source: stash-enterprise/templates/gerbage-collector-rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: appscode:stash:garbage-collector
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: appscode:stash:garbage-collector
subjects:
- kind: ServiceAccount
  name: generic-garbage-collector
  namespace: kube-system
---
# Source: stash-enterprise/templates/cleaner/job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: my-stash-enterprise-cleaner
  namespace: default
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-delete-policy": hook-succeeded,hook-failed
spec:
  backoffLimit: 3
  activeDeadlineSeconds: 600
  template:
    spec:
      
      serviceAccountName: my-stash-enterprise-cleaner
      containers:
      - name: busybox
        image: ghcr.io/appscode/kubectl:v1.22
        command:
          - sh
          - -c
          - "sleep 2; \
           kubectl delete job my-stash-enterprise-crd-installer -n default || true; \
           kubectl delete functions.stash.appscode.com update-status pvc-backup pvc-restore || true; \
           kubectl delete tasks.stash.appscode.com pvc-backup pvc-restore || true;"
        imagePullPolicy: IfNotPresent
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsNonRoot: true
          runAsUser: 65534
      restartPolicy: Never
      nodeSelector:
        kubernetes.io/os: linux
---
# Source: stash-enterprise/templates/crd-installer/job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: my-stash-enterprise-crd-installer
  namespace: default
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade,pre-rollback
    "helm.sh/hook-delete-policy": before-hook-creation,hook-failed
spec:
  backoffLimit: 3
  activeDeadlineSeconds: 300
  ttlSecondsAfterFinished: 10
  template:
    spec:
      
      serviceAccountName: my-stash-enterprise-crd-installer
      containers:
        - name: installer
          image: "ghcr.io/stashed/stash-crd-installer:v0.35.0"
          args:
            - --enterprise=true
          imagePullPolicy: IfNotPresent
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 65534
      restartPolicy: Never
      nodeSelector:
        kubernetes.io/os: linux
---
# Source: stash-enterprise/templates/mutating-webhook.yaml
# GKE returns Major:"1", Minor:"10+"
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: admission.stash.appscode.com
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
webhooks:
- name: deployment.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1alpha1/deploymentmutators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - apps
    - extensions
    apiVersions:
    - "*"
    resources:
    - deployments
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: daemonset.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1alpha1/daemonsetmutators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - apps
    - extensions
    apiVersions:
    - "*"
    resources:
    - daemonsets
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: statefulset.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1alpha1/statefulsetmutators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    apiGroups:
    - apps
    apiVersions:
    - "*"
    resources:
    - statefulsets
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: deploymentconfig.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1alpha1/deploymentconfigmutators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - apps.openshift.io
    apiVersions:
    - "*"
    resources:
    - deploymentconfigs
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: restoresession.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1beta1/restoresessionmutators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - stash.appscode.com
    apiVersions:
    - "*"
    resources:
    - restoresessions
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
---
# Source: stash-enterprise/templates/validating-webhook.yaml
# GKE returns Major:"1", Minor:"10+"
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: admission.stash.appscode.com
  labels:
    helm.sh/chart: stash-enterprise-v0.35.0
    app.kubernetes.io/name: stash-enterprise
    app.kubernetes.io/instance: my-stash-enterprise
    app.kubernetes.io/version: "v0.35.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-delete-policy": before-hook-creation
webhooks:
- name: restic.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1alpha1/resticvalidators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - stash.appscode.com
    apiVersions:
    - "*"
    resources:
    - restics
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: recovery.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1alpha1/recoveryvalidators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - stash.appscode.com
    apiVersions:
    - "*"
    resources:
    - recoveries
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: repository.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1alpha1/repositoryvalidators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - stash.appscode.com
    apiVersions:
    - "*"
    resources:
    - repositories
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: restoresession.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1beta1/restoresessionvalidators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - stash.appscode.com
    apiVersions:
    - "*"
    resources:
    - restoresessions
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: restorebatch.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1beta1/restorebatchvalidators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - stash.appscode.com
    apiVersions:
    - "*"
    resources:
    - restorebatches
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: backupconfiguration.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1beta1/backupconfigurationvalidators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - stash.appscode.com
    apiVersions:
    - "*"
    resources:
    - backupconfigurations
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: backupbatch.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1beta1/backupbatchvalidators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - stash.appscode.com
    apiVersions:
    - "*"
    resources:
    - backupbatches
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
- name: backupblueprint.admission.stash.appscode.com
  clientConfig:
    service:
      namespace: default
      name: kubernetes
      path: /apis/admission.stash.appscode.com/v1beta1/backupblueprintvalidators
    caBundle: bm90LWNhLWNlcnQ=
  rules:
  - operations:
    - CREATE
    - UPDATE
    apiGroups:
    - stash.appscode.com
    apiVersions:
    - "*"
    resources:
    - backupblueprints
  admissionReviewVersions: ["v1beta1"]
  failurePolicy: Ignore
  sideEffects: None
