---
# Source: accumulo/charts/hdfs/templates/datanodes-netpol.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: my-accumulo-hdfs-datanodes
  labels:
    
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: datanode
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: hdfs
      app.kubernetes.io/instance: my-accumulo
      app.kubernetes.io/component: datanode
  policyTypes:
  - Ingress
  ingress:
  # Allow clients to access client RPC and HTTP servers
  - ports:
    - port: http
    - port: https
    - port: data-xfer
  # Allow NameNode and DataNodes to access IPC Server
  - from:
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: hdfs
          app.kubernetes.io/instance: my-accumulo
    ports:
    - port: ipc
---
# Source: accumulo/charts/hdfs/templates/namenode-netpol.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: my-accumulo-hdfs-namenodes
  labels:
    
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: namenode
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/name: hdfs
      app.kubernetes.io/instance: my-accumulo
      app.kubernetes.io/component: namenode
  policyTypes:
  - Ingress
  ingress:
  # Allow clients to access client RPC and HTTP servers
  - ports:
    - port: http
    - port: https
    - port: client-rpc
  # Allow NameNode and DataNodes to access Service and Lifeline RPC Servers
  - from:
    - podSelector:
        matchLabels:
          app.kubernetes.io/name: hdfs
          app.kubernetes.io/instance: my-accumulo
    ports:
    - port: service-rpc
    - port: lifeline-rpc
---
# Source: accumulo/charts/zookeeper/templates/poddisruptionbudget.yaml
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  name: my-accumulo-zookeeper
  labels:
    app: zookeeper
    chart: zookeeper-2.1.5
    release: my-accumulo
    heritage: Helm
    component: server
spec:
  selector:
    matchLabels:
      app: zookeeper
      release: my-accumulo
      component: server
  maxUnavailable: 1
---
# Source: accumulo/charts/hdfs/templates/namenode-serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: my-accumulo-hdfs-namenode
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: namenode
---
# Source: accumulo/charts/hdfs/templates/secrets.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: Secret
metadata:
  name: my-accumulo-hdfs
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
data:
---
# Source: accumulo/templates/config.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-accumulo-config
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: accumulo-config
data:
  accumulo.properties: "aW5zdGFuY2Uudm9sdW1lcz1oZGZzOi8vbXktYWNjdW11bG8taGRmcy1uYW1lbm9kZS0wLm15LWFjY3VtdWxvLWhkZnMtbmFtZW5vZGVzOjgwMjAvYWNjdW11bG8KaW5zdGFuY2Uuem9va2VlcGVyLmhvc3Q9bXktYWNjdW11bG8tem9va2VlcGVyCgpnZW5lcmFsLnZmcy5jbGFzc3BhdGhzPSRBQ0NVTVVMT19IT01FL2xpYi9leHQvW14uXS4qLmphcgp0cmFjZS51c2VyPXRyYWNlcgp0cmFjZS50b2tlbi5wcm9wZXJ0eS5wYXNzd29yZD10cmFjZXIKaW5zdGFuY2Uuc2VjcmV0PURFRkFVTFQKdHNlcnZlci5jYWNoZS5kYXRhLnNpemU9MTVNCnRzZXJ2ZXIuY2FjaGUuaW5kZXguc2l6ZT00ME0KdHNlcnZlci5tZW1vcnkubWFwcy5tYXg9MTI4TQp0c2VydmVyLm1lbW9yeS5tYXBzLm5hdGl2ZS5lbmFibGVkPXRydWUKdHNlcnZlci5zb3J0LmJ1ZmZlci5zaXplPTUwTQp0c2VydmVyLnRvdGFsLm11dGF0aW9uLnF1ZXVlLm1heD0xNk0KdHNlcnZlci53YWxvZy5tYXguc2l6ZT0xMjhN"
  accumulo-client.properties: "YXV0aC50eXBlPXBhc3N3b3JkCmF1dGgucHJpbmNpcGFsPXJvb3QKYXV0aC50b2tlbj1yb290Cmluc3RhbmNlLm5hbWU9YWNjdW11bG8KaW5zdGFuY2Uuem9va2VlcGVycz1teS1hY2N1bXVsby16b29rZWVwZXI="
  accumulo-env.sh: "IyEgL3Vzci9iaW4vZW52IGJhc2gKCiMgQ29weXJpZ2h0IDIwMjIgQ3Jvd24gQ29weXJpZ2h0CiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiMKIyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKIyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KIyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiMgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIFZhcmlhYmxlcyB0aGF0IG11c3QgYmUgc2V0CiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiMjIEFjY3VtdWxvIGxvZ3MgZGlyZWN0b3J5LiBSZWZlcmVuY2VkIGJ5IGxvZ2dlciBjb25maWcuCmV4cG9ydCBBQ0NVTVVMT19MT0dfRElSPSIke0FDQ1VNVUxPX0xPR19ESVI6LSR7YmFzZWRpcn0vbG9nc30iCiMjIEhhZG9vcCBpbnN0YWxsYXRpb24KZXhwb3J0IEhBRE9PUF9IT01FPSIke0hBRE9PUF9IT01FOi0vcGF0aC90by9oYWRvb3B9IgojIyBIYWRvb3AgY29uZmlndXJhdGlvbgpleHBvcnQgSEFET09QX0NPTkZfRElSPSIke0hBRE9PUF9DT05GX0RJUjotJHtIQURPT1BfSE9NRX0vZXRjL2hhZG9vcH0iCiMjIFpvb2tlZXBlciBpbnN0YWxsYXRpb24KZXhwb3J0IFpPT0tFRVBFUl9IT01FPSIke1pPT0tFRVBFUl9IT01FOi0vcGF0aC90by96b29rZWVwZXJ9IgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBCdWlsZCBDTEFTU1BBVEggdmFyaWFibGUKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiMjIFZlcmlmeSB0aGF0IEhhZG9vcCAmIFpvb2tlZXBlciBpbnN0YWxsYXRpb24gZGlyZWN0b3JpZXMgZXhpc3QKaWYgW1sgISAtZCAiJFpPT0tFRVBFUl9IT01FIiBdXTsgdGhlbgogIGVjaG8gIlpPT0tFRVBFUl9IT01FPSRaT09LRUVQRVJfSE9NRSBpcyBub3Qgc2V0IHRvIGEgdmFsaWQgZGlyZWN0b3J5IGluIGFjY3VtdWxvLWVudi5zaCIKICBleGl0IDEKZmkKaWYgW1sgISAtZCAiJEhBRE9PUF9IT01FIiBdXTsgdGhlbgogIGVjaG8gIkhBRE9PUF9IT01FPSRIQURPT1BfSE9NRSBpcyBub3Qgc2V0IHRvIGEgdmFsaWQgZGlyZWN0b3J5IGluIGFjY3VtdWxvLWVudi5zaCIKICBleGl0IDEKZmkKCiMjIEJ1aWxkIHVzaW5nIGV4aXN0aW5nIENMQVNTUEFUSCwgY29uZi8gZGlyZWN0b3J5LCBkZXBlbmRlbmNpZXMgaW4gbGliLywgYW5kIGV4dGVybmFsIEhhZG9vcCAmIFpvb2tlZXBlciBkZXBlbmRlbmNpZXMKaWYgW1sgLW4gIiRDTEFTU1BBVEgiIF1dOyB0aGVuCiAgQ0xBU1NQQVRIPSIke0NMQVNTUEFUSH06JHtjb25mfSIKZWxzZQogIENMQVNTUEFUSD0iJHtjb25mfSIKZmkKQ0xBU1NQQVRIPSIke0NMQVNTUEFUSH06JHtsaWJ9Lyo6JHtIQURPT1BfQ09ORl9ESVJ9OiR7Wk9PS0VFUEVSX0hPTUV9Lyo6JHtaT09LRUVQRVJfSE9NRX0vbGliLyo6JHtIQURPT1BfSE9NRX0vc2hhcmUvaGFkb29wL2NsaWVudC8qIgpleHBvcnQgQ0xBU1NQQVRICgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBCdWlsZCBKQVZBX09QVFMgdmFyaWFibGUuIERlZmF1bHRzIGJlbG93IHdvcmsgYnV0IGNhbiBiZSBlZGl0ZWQuCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKIyMgSlZNIG9wdGlvbnMgc2V0IGZvciBhbGwgcHJvY2Vzc2VzLiBFeHRyYSBvcHRpb25zIGNhbiBiZSBwYXNzZWQgaW4gYnkgc2V0dGluZyBBQ0NVTVVMT19KQVZBX09QVFMgdG8gYW4gYXJyYXkgb2Ygb3B0aW9ucy4KSkFWQV9PUFRTPSgiJHtBQ0NVTVVMT19KQVZBX09QVFNbQF19IgogICctWFg6K1VzZUNvbmNNYXJrU3dlZXBHQycKICAnLVhYOkNNU0luaXRpYXRpbmdPY2N1cGFuY3lGcmFjdGlvbj03NScKICAnLVhYOitDTVNDbGFzc1VubG9hZGluZ0VuYWJsZWQnCiAgJy1YWDpPbk91dE9mTWVtb3J5RXJyb3I9a2lsbCAtOSAlcCcKICAnLVhYOi1PbWl0U3RhY2tUcmFjZUluRmFzdFRocm93JwogICctRGphdmEubmV0LnByZWZlcklQdjRTdGFjaz10cnVlJwogICItRGFjY3VtdWxvLm5hdGl2ZS5saWIucGF0aD0ke2xpYn0vbmF0aXZlIikKCiMjIE1ha2Ugc3VyZSBBY2N1bXVsbyBuYXRpdmUgbGlicmFyaWVzIGFyZSBidWlsdCBzaW5jZSB0aGV5IGFyZSBlbmFibGVkIGJ5IGRlZmF1bHQKIyAiJHtiaW59Ii9hY2N1bXVsby11dGlsIGJ1aWxkLW5hdGl2ZSAmPiAvZGV2L251bGwKCiMjIEpWTSBvcHRpb25zIHNldCBmb3IgaW5kaXZpZHVhbCBhcHBsaWNhdGlvbnMKY2FzZSAiJGNtZCIgaW4KICBtYXN0ZXIpICBKQVZBX09QVFM9KCIke0pBVkFfT1BUU1tAXX0iICctWG14NTEybScgJy1YbXM1MTJtJykgOzsKICBtb25pdG9yKSBKQVZBX09QVFM9KCIke0pBVkFfT1BUU1tAXX0iICctWG14MjU2bScgJy1YbXMyNTZtJykgOzsKICBnYykgICAgICBKQVZBX09QVFM9KCIke0pBVkFfT1BUU1tAXX0iICctWG14MjU2bScgJy1YbXMyNTZtJykgOzsKICB0c2VydmVyKSBKQVZBX09QVFM9KCIke0pBVkFfT1BUU1tAXX0iICctWG14NzY4bScgJy1YbXM3NjhtJykgOzsKICAqKSAgICAgICBKQVZBX09QVFM9KCIke0pBVkFfT1BUU1tAXX0iICctWG14MjU2bScgJy1YbXM2NG0nKSA7Owplc2FjCgojIyBKVk0gb3B0aW9ucyBzZXQgZm9yIGxvZ2dpbmcuIFJldmlldyBsb2dqNCBwcm9wZXJ0aWVzIGZpbGVzIHRvIHNlZSBob3cgdGhleSBhcmUgdXNlZC4KSkFWQV9PUFRTPSgiJHtKQVZBX09QVFNbQF19IgogICItRGFjY3VtdWxvLmxvZy5kaXI9JHtBQ0NVTVVMT19MT0dfRElSfSIKICAiLURhY2N1bXVsby5hcHBsaWNhdGlvbj0ke2NtZH0ke0FDQ1VNVUxPX1NFUlZJQ0VfSU5TVEFOQ0V9XyQoaG9zdG5hbWUpIikKCmNhc2UgIiRjbWQiIGluCiAgbW9uaXRvcikKICAgIEpBVkFfT1BUUz0oIiR7SkFWQV9PUFRTW0BdfSIgIi1EbG9nNGouY29uZmlndXJhdGlvbj1sb2c0ai1tb25pdG9yLnByb3BlcnRpZXMiKQogICAgOzsKICBnY3xtYXN0ZXJ8dHNlcnZlcnx0cmFjZXIpCiAgICBKQVZBX09QVFM9KCIke0pBVkFfT1BUU1tAXX0iICItRGxvZzRqLmNvbmZpZ3VyYXRpb249bG9nNGotc2VydmljZS5wcm9wZXJ0aWVzIikKICAgIDs7CiAgKikKICAgICMgbGV0IGxvZzRqIHVzZSBpdHMgZGVmYXVsdCBiZWhhdmlvciAobG9nNGoueG1sLCBsb2c0ai5wcm9wZXJ0aWVzKQogICAgdHJ1ZQogICAgOzsKZXNhYwoKZXhwb3J0IEpBVkFfT1BUUwoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIFZhcmlhYmxlcyBzZXQgdG8gYSBkZWZhdWx0CiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmV4cG9ydCBNQUxMT0NfQVJFTkFfTUFYPSR7TUFMTE9DX0FSRU5BX01BWDotMX0KIyMgQWRkIEhhZG9vcCBuYXRpdmUgbGlicmFyaWVzIHRvIHNoYXJlZCBsaWJyYXJ5IHBhdGhzIGdpdmVuIG9wZXJhdGluZyBzeXN0ZW0KY2FzZSAiJCh1bmFtZSkiIGluCiAgRGFyd2luKSBleHBvcnQgRFlMRF9MSUJSQVJZX1BBVEg9IiR7SEFET09QX0hPTUV9L2xpYi9uYXRpdmU6JHtEWUxEX0xJQlJBUllfUEFUSH0iIDs7CiAgKikgICAgICBleHBvcnQgTERfTElCUkFSWV9QQVRIPSIke0hBRE9PUF9IT01FfS9saWIvbmF0aXZlOiR7TERfTElCUkFSWV9QQVRIfSIgOzsKZXNhYwoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBWYXJpYWJsZXMgdGhhdCBhcmUgb3B0aW9uYWwuIFVuY29tbWVudCB0byBzZXQKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiMjIFNwZWNpZmllcyBjb21tYW5kIHRoYXQgd2lsbCBiZSBwbGFjZWQgYmVmb3JlIGNhbGxzIHRvIEphdmEgaW4gYWNjdW11bG8gc2NyaXB0CiMgZXhwb3J0IEFDQ1VNVUxPX0pBVkFfUFJFRklYPSIiCg=="
  core-site.xml: "PCEtLQogIH4gQ29weXJpZ2h0IDIwMjAtMjAyMiBDcm93biBDb3B5cmlnaHQKICB+CiAgfiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB+IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICB+IFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogIH4KICB+ICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICB+CiAgfiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgfiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogIH4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgfiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgfiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAtLT4KPGNvbmZpZ3VyYXRpb24+PC9jb25maWd1cmF0aW9uPgo="
  log4j-monitor.properties: "IyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lIG9yIG1vcmUKIyBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3RyaWJ1dGVkIHdpdGgKIyB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuCiMgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8gWW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAKIyAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aAojIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoKIyMgTG9nNGogMS4yIGZpbGUgdGhhdCBjb25maWd1cmVzIGxvZ2dpbmcgZm9yIEFjY3VtdWxvIE1vbml0b3IKIyMgVGhlIHN5c3RlbSBwcm9wZXJ0aWVzIHJlZmVyZW5jZWQgYmVsb3cgYXJlIGNvbmZpZ3VyZWQgYnkgYWNjdW11bG8tZW52LnNoCgojIyBEZWZpbmUgYSBsb2cgZmlsZSBhcHBlbmRlcgpsb2c0ai5hcHBlbmRlci5maWxlPW9yZy5hcGFjaGUubG9nNGouUm9sbGluZ0ZpbGVBcHBlbmRlcgpsb2c0ai5hcHBlbmRlci5maWxlLkZpbGU9JHthY2N1bXVsby5sb2cuZGlyfS8ke2FjY3VtdWxvLmFwcGxpY2F0aW9ufS5sb2cKbG9nNGouYXBwZW5kZXIuZmlsZS5NYXhGaWxlU2l6ZT0xMDBNQgpsb2c0ai5hcHBlbmRlci5maWxlLk1heEJhY2t1cEluZGV4PTEwCmxvZzRqLmFwcGVuZGVyLmZpbGUuVGhyZXNob2xkPUFMTApsb2c0ai5hcHBlbmRlci5maWxlLmxheW91dD1vcmcuYXBhY2hlLmxvZzRqLlBhdHRlcm5MYXlvdXQKbG9nNGouYXBwZW5kZXIuZmlsZS5sYXlvdXQuQ29udmVyc2lvblBhdHRlcm49JWR7SVNPODYwMX0gWyUtOGN7Mn1dICUtNXA6ICVtJW4KCiMjIERlZmluZSBhbiBhcHBlbmRlciBmb3IgdGhlIEFjY3VtdWxvIE1vbml0b3IgdG8gbG9nIHRvIGl0cyBvd24gd2ViIEdVSQpsb2c0ai5hcHBlbmRlci5ndWk9b3JnLmFwYWNoZS5hY2N1bXVsby5zZXJ2ZXIubW9uaXRvci5Mb2dTZXJ2aWNlCmxvZzRqLmFwcGVuZGVyLmd1aS5UaHJlc2hvbGQ9V0FSTgoKIyMgQXBwZW5kIG1vbml0b3IgbG9ncyB0byBpdHMgb3duIHdlYiBHVUkKbG9nNGoubG9nZ2VyLm9yZy5hcGFjaGUuYWNjdW11bG89SU5IRVJJVEVELCBndWkKCiMjIEFwcGVuZCBtb3N0IGxvZ3MgdG8gZmlsZQpsb2c0ai5yb290TG9nZ2VyPUlORk8sIGZpbGU="
  log4j-service.properties: "IyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lIG9yIG1vcmUKIyBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3RyaWJ1dGVkIHdpdGgKIyB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuCiMgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8gWW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAKIyAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aAojIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAojCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQojIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiMgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiMgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAojIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoKIyMgTG9nNGogMS4yIGZpbGUgdGhhdCBjb25maWd1cmVzIGxvZ2dpbmcgZm9yIGFsbCBBY2N1bXVsbyBzZXJ2aWNlcyAoTWFzdGVyLCBUYWJsZXRTZXJ2ZXIsIEdDLCBhbmQgVHJhY2VyKSBleGNlcHQgTW9uaXRvcgojIyBUaGUgc3lzdGVtIHByb3BlcnRpZXMgcmVmZXJlbmNlZCBiZWxvdyBhcmUgY29uZmlndXJlZCBieSBhY2N1bXVsby1lbnYuc2gKCiMjIERlZmluZSBhIGxvZyBmaWxlIGFwcGVuZGVyCmxvZzRqLmFwcGVuZGVyLmZpbGU9b3JnLmFwYWNoZS5sb2c0ai5Sb2xsaW5nRmlsZUFwcGVuZGVyCmxvZzRqLmFwcGVuZGVyLmZpbGUuRmlsZT0ke2FjY3VtdWxvLmxvZy5kaXJ9LyR7YWNjdW11bG8uYXBwbGljYXRpb259LmxvZwpsb2c0ai5hcHBlbmRlci5maWxlLk1heEZpbGVTaXplPTEwME1CCmxvZzRqLmFwcGVuZGVyLmZpbGUuTWF4QmFja3VwSW5kZXg9MTAKbG9nNGouYXBwZW5kZXIuZmlsZS5UaHJlc2hvbGQ9QUxMCmxvZzRqLmFwcGVuZGVyLmZpbGUubGF5b3V0PW9yZy5hcGFjaGUubG9nNGouUGF0dGVybkxheW91dApsb2c0ai5hcHBlbmRlci5maWxlLmxheW91dC5Db252ZXJzaW9uUGF0dGVybj0lZHtJU084NjAxfSBbJS04Y3syfV0gJS01cDogJW0lbgoKIyMgRGVmaW5lIGFuIGFwcGVuZGVyIHRvIHNlbmQgaW1wb3J0YW50IGxvZ3MgdG8gdGhlIHRoZSBwcmltYXJ5IEFjY3VtdWxvIE1vbml0b3IKIyMgVGhlIHByaW1hcnkgbW9uaXRvciBpcyB0aGUgb25lIGN1cnJlbnRseSBob2xkaW5nIGEgc2hhcmVkIGxvY2sgaW4gWm9vS2VlcGVyLAojIyBhbmQgaXMgdHlwaWNhbGx5IHRoZSBvbmUgdGhhdCBzdGFydGVkIGZpcnN0Lgpsb2c0ai5hcHBlbmRlci5tb25pdG9yPW9yZy5hcGFjaGUuYWNjdW11bG8ubW9uaXRvci51dGlsLkFjY3VtdWxvTW9uaXRvckFwcGVuZGVyCmxvZzRqLmFwcGVuZGVyLm1vbml0b3IuVGhyZXNob2xkPVdBUk4KCiMjIFVuY29tbWVudCB0byBkZWZpbmUgYSBsb2cgZmlsZSBhcHBlbmRlciBmb3IgYXVkaXQgbG9ncwojbG9nNGouYXBwZW5kZXIuYXVkaXQ9b3JnLmFwYWNoZS5sb2c0ai5EYWlseVJvbGxpbmdGaWxlQXBwZW5kZXIKI2xvZzRqLmFwcGVuZGVyLmF1ZGl0LkZpbGU9JHthY2N1bXVsby5sb2cuZGlyfS8ke2FjY3VtdWxvLmFwcGxpY2F0aW9ufS5hdWRpdAojbG9nNGouYXBwZW5kZXIuYXVkaXQuRGF0ZVBhdHRlcm49Jy4neXl5eS1NTS1kZAojbG9nNGouYXBwZW5kZXIuYXVkaXQubGF5b3V0PW9yZy5hcGFjaGUubG9nNGouUGF0dGVybkxheW91dAojbG9nNGouYXBwZW5kZXIuYXVkaXQubGF5b3V0LkNvbnZlcnNpb25QYXR0ZXJuPSVke0lTTzg2MDF9IFslY3syfV0gJS01cDogJW0lbgojbG9nNGouYWRkaXRpdml0eS5vcmcuYXBhY2hlLmFjY3VtdWxvLmF1ZGl0PWZhbHNlCgojIyBDaGFuZ2UgdGhpcyBsb2cgbGV2ZWwgZnJvbSBPRkYgdG8gb25lIG9mIHRoZSBmb2xsb3dpbmcgdG8gZW5hYmxlIGF1ZGl0IGxvZ2dpbmc6CiMjICAgSU5GTwojIyAgICAgZW5hYmxlcyBhdWRpdCBsb2dnaW5nIChpbmhlcml0IGFwcGVuZGVycyBmcm9tIHJvb3QgbG9nZ2VyKQojIyAgIElORk8sIGF1ZGl0CiMjICAgICBlbmFibGVzIGF1ZGl0IGxvZ2dpbmcgdXNpbmcgdGhlIGF1ZGl0IGxvZyBhcHBlbmRlcgojIyAgICAgKHJlcXVpcmVzIGF1ZGl0IGxvZyBmaWxlIGFwcGVuZGVyIGFib3ZlIHRvIGJlIHVuY29tbWVudGVkKQpsb2c0ai5sb2dnZXIub3JnLmFwYWNoZS5hY2N1bXVsby5hdWRpdD1PRkYKCiMjIEFwcGVuZCBsb2dzIHRvIHRoZSBwcmltYXJ5IEFjY3VtdWxvIE1vbml0b3IKbG9nNGoubG9nZ2VyLm9yZy5hcGFjaGUuYWNjdW11bG89SU5IRVJJVEVELCBtb25pdG9yCgojIyBDb25zdHJhaW4gc29tZSBwYXJ0aWN1bGFybHkgc3BhbW15IGxvZ2dlcnMKbG9nNGoubG9nZ2VyLm9yZy5hcGFjaGUuYWNjdW11bG8uY29yZS5maWxlLnJmaWxlLmJjZmlsZT1JTkZPCmxvZzRqLmxvZ2dlci5vcmcuYXBhY2hlLnpvb2tlZXBlcj1FUlJPUgoKIyMgQXBwZW5kIG1vc3QgbG9ncyB0byBmaWxlCmxvZzRqLnJvb3RMb2dnZXI9SU5GTywgZmlsZQ=="
  log4j.properties: "IyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lIG9yIG1vcmUKIyBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3RyaWJ1dGVkIHdpdGgKIyB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuCiMgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUgdG8gWW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAKIyAodGhlICJMaWNlbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aAojIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiMKIyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKIyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KIyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiMgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgojIyBMb2c0aiAxLjIgZmlsZSB0aGF0IGNvbmZpZ3VyZXMgbG9nZ2luZyBmb3IgY2xpZW50cyBhbmQgdXRpbGl0eSBjb21tYW5kcwoKIyMgRGVmaW5lIGEgY29uc29sZSBhcHBlbmRlcgpsb2c0ai5hcHBlbmRlci5jb25zb2xlPW9yZy5hcGFjaGUubG9nNGouQ29uc29sZUFwcGVuZGVyCmxvZzRqLmFwcGVuZGVyLmNvbnNvbGUuVGFyZ2V0PVN5c3RlbS5lcnIKbG9nNGouYXBwZW5kZXIuY29uc29sZS5UaHJlc2hvbGQ9QUxMCmxvZzRqLmFwcGVuZGVyLmNvbnNvbGUubGF5b3V0LkNvbnZlcnNpb25QYXR0ZXJuPSVke0lTTzg2MDF9IFslLThjezJ9XSAlLTVwOiAlbSVuCmxvZzRqLmFwcGVuZGVyLmNvbnNvbGUubGF5b3V0PW9yZy5hcGFjaGUubG9nNGouUGF0dGVybkxheW91dAoKIyMgSGlkZSBhdWRpdCBsb2dzIGdlbmVyYXRlZCBieSB0aGUgc2hlbGwKbG9nNGoubG9nZ2VyLm9yZy5hcGFjaGUuYWNjdW11bG8uc2hlbGwuU2hlbGwuYXVkaXQ9V0FSTgoKIyMgQ29uc3RyYWluIHNvbWUgcGFydGljdWxhcmx5IHNwYW1teSBsb2dnZXJzCmxvZzRqLmxvZ2dlci5vcmcuYXBhY2hlLmFjY3VtdWxvLmNvcmUuZmlsZS5yZmlsZS5iY2ZpbGUuQ29tcHJlc3Npb249V0FSTgpsb2c0ai5sb2dnZXIub3JnLmFwYWNoZS5jb21tb25zLnZmczIuaW1wbC5EZWZhdWx0RmlsZVN5c3RlbU1hbmFnZXI9V0FSTgpsb2c0ai5sb2dnZXIub3JnLmFwYWNoZS5oYWRvb3AuaW8uY29tcHJlc3M9V0FSTgpsb2c0ai5sb2dnZXIub3JnLmFwYWNoZS56b29rZWVwZXI9RVJST1IKCiMjIFVuY29tbWVudCB0aGUgZm9sbG93aW5nIGZvciBkZXRhaWxlZCBsb2dnaW5nIChmb3IgZXhhbXBsZSwgaW4gdGhlIFNoZWxsKQojbG9nNGoubG9nZ2VyLm9yZy5hcGFjaGUuYWNjdW11bG8uY29yZT1UUkFDRQoKIyMgQXBwZW5kIG1vc3QgbG9ncyB0byBjb25zb2xlCmxvZzRqLnJvb3RMb2dnZXI9SU5GTywgY29uc29sZQ=="
---
# Source: accumulo/templates/post-install-cmds/secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-accumulo-cmds
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
type: Opaque
data:
  run.sh: IyEvYmluL2Jhc2ggLWUKCkRJUj0iJCggY2QgIiQoIGRpcm5hbWUgIiR7QkFTSF9TT1VSQ0VbMF19IiApIiAmJiBwd2QgKSIKY2QgJERJUgoKQ0xJRU5UX0NPTkZfRklMRT0iJHtBQ0NVTVVMT19DT05GX0RJUn0vYWNjdW11bG8tY2xpZW50LnByb3BlcnRpZXMiClsgLWYgIiR7QUNDVU1VTE9fQ09ORl9ESVJ9L2NsaWVudC5jb25mIiBdICYmIENMSUVOVF9DT05GX0ZJTEU9IiR7QUNDVU1VTE9fQ09ORl9ESVJ9L2NsaWVudC5jb25mIgoKVVNFUk5BTUU9JChncmVwICJhdXRoLnByaW5jaXBhbCIgIiR7Q0xJRU5UX0NPTkZfRklMRX0iIHwgZ3JlcCAtdiAiXiMiIHwgY3V0IC1kPSAtZjIpClBBU1NXT1JEPSQoZ3JlcCAiYXV0aC50b2tlbiIgIiR7Q0xJRU5UX0NPTkZfRklMRX0iIHwgZ3JlcCAtdiAiXiMiIHwgY3V0IC1kPSAtZjIpCltbIC16ICIke1VTRVJOQU1FfSIgfHwgLXogIiR7UEFTU1dPUkR9IiBdXSAmJiBlY2hvICJVbmFibGUgdG8gbG9jYXRlIEFjY3VtdWxvIHVzZXJuYW1lIGFuZCBwYXNzd29yZCBpbiAke0NMSUVOVF9DT05GX0ZJTEV9IiAmJiBleGl0IDEKCnVudGlsIGFjY3VtdWxvIHNoZWxsIC11ICR7VVNFUk5BTUV9IC1wICR7UEFTU1dPUkR9IC1lIGluZm8gfHwgWyAkKCggQVRURU1QVFMrKyApKSAtZ3QgNjAgXTsgZG8KICBlY2hvICIkKGRhdGUpIC0gV2FpdGluZyBmb3IgQWNjdW11bG8gaW5zdGFuY2UgdG8gYmUgcmVhZHkuLi4iCiAgc2xlZXAgNQpkb25lCgphY2N1bXVsbyBzaGVsbCAtZnYgLi9jb21tYW5kcy50eHQgLXUgJHtVU0VSTkFNRX0gLXAgJHtQQVNTV09SRH0=
  accumulo-user-management.js: dmFyIGFsbFN5c3RlbVBlcm1pc3Npb25zID0gb3JnLmFwYWNoZS5hY2N1bXVsby5jb3JlLnNlY3VyaXR5LlN5c3RlbVBlcm1pc3Npb24udmFsdWVzKCk7CnZhciBhbGxUYWJsZVBlcm1pc3Npb25zID0gb3JnLmFwYWNoZS5hY2N1bXVsby5jb3JlLnNlY3VyaXR5LlRhYmxlUGVybWlzc2lvbi52YWx1ZXMoKTsKdmFyIHJldm9rZUVuYWJsZWQgPSAidHJ1ZSI7CgpmdW5jdGlvbiBwcm9jZXNzVXNlciAodXNlcm5hbWUsIHBhc3N3b3JkLCBhdXRocywgc3lzdGVtUGVybWlzc2lvbnMsIHRhYmxlUGVybWlzc2lvbnMpIHsKICB2YXIgcGFzc3dvcmRUb2tlbiA9IG5ldyBvcmcuYXBhY2hlLmFjY3VtdWxvLmNvcmUuY2xpZW50LnNlY3VyaXR5LnRva2Vucy5QYXNzd29yZFRva2VuKHBhc3N3b3JkKTsKCiAgdmFyIHVzZXJFeGlzdHMgPSBjb25uZWN0aW9uLnNlY3VyaXR5T3BlcmF0aW9ucygpLmxpc3RMb2NhbFVzZXJzKCkuY29udGFpbnModXNlcm5hbWUpOwogIGlmICghdXNlckV4aXN0cykgewogICAgcHJpbnQoJ0NyZWF0aW5nIHVzZXI6ICcgKyB1c2VybmFtZSkKICAgIGNvbm5lY3Rpb24uc2VjdXJpdHlPcGVyYXRpb25zKCkuY3JlYXRlTG9jYWxVc2VyKHVzZXJuYW1lLCBwYXNzd29yZFRva2VuKTsKICB9IGVsc2UgewogICAgcHJpbnQoJ1NldHRpbmcgcGFzc3dvcmQgZm9yOiAnICsgdXNlcm5hbWUpCiAgICBjb25uZWN0aW9uLnNlY3VyaXR5T3BlcmF0aW9ucygpLmNoYW5nZUxvY2FsVXNlclBhc3N3b3JkKHVzZXJuYW1lLCBwYXNzd29yZFRva2VuKTsKICB9CgogIGlmIChhdXRocyA9PSAiIikgewogICAgcHJpbnQoJ0NsZWFyaW5nIGF1dGhvcml6YXRpb25zIGZvcjogJyArIHVzZXJuYW1lKQogICAgY29ubmVjdGlvbi5zZWN1cml0eU9wZXJhdGlvbnMoKS5jaGFuZ2VVc2VyQXV0aG9yaXphdGlvbnModXNlcm5hbWUsIG9yZy5hcGFjaGUuYWNjdW11bG8uY29yZS5zZWN1cml0eS5BdXRob3JpemF0aW9ucy5FTVBUWSk7CiAgfSBlbHNlIHsKICAgIHZhciBhdXRoU3RyaW5nTGlzdCA9IGF1dGhzLnNwbGl0KCIsIik7CiAgICB2YXIgYXV0aEJ5dGVCdWZmZXJMaXN0ID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3QoKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXV0aFN0cmluZ0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGF1dGggPSBhdXRoU3RyaW5nTGlzdFtpXTsKICAgICAgYXV0aEJ5dGVCdWZmZXJMaXN0LmFkZChqYXZhLm5pby5CeXRlQnVmZmVyLndyYXAoYXV0aC5nZXRCeXRlcygpKSk7CiAgICB9CiAgICBwcmludCgnU2V0dGluZyBhdXRob3JpemF0aW9ucyBmb3I6ICcgKyB1c2VybmFtZSArICcgdG86ICcgKyBhdXRocykKICAgIGNvbm5lY3Rpb24uc2VjdXJpdHlPcGVyYXRpb25zKCkuY2hhbmdlVXNlckF1dGhvcml6YXRpb25zKHVzZXJuYW1lLCBuZXcgb3JnLmFwYWNoZS5hY2N1bXVsby5jb3JlLnNlY3VyaXR5LkF1dGhvcml6YXRpb25zKGF1dGhCeXRlQnVmZmVyTGlzdCkpOwogIH0KCiAgdmFyIHN5c1Blcm1pc3Npb25MaXN0ID0gc3lzdGVtUGVybWlzc2lvbnMuc3BsaXQoJywnKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGFsbFN5c3RlbVBlcm1pc3Npb25zLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgcGVybWlzc2lvbiA9IGFsbFN5c3RlbVBlcm1pc3Npb25zW2ldOwogICAgaWYgKGNvbm5lY3Rpb24uc2VjdXJpdHlPcGVyYXRpb25zKCkuaGFzU3lzdGVtUGVybWlzc2lvbih1c2VybmFtZSwgcGVybWlzc2lvbikpIHsKICAgICAgaWYgKHJldm9rZUVuYWJsZWQgPT0gJ3RydWUnICYmIHN5c1Blcm1pc3Npb25MaXN0LmluZGV4T2YocGVybWlzc2lvbi50b1N0cmluZygpKSA9PSAtMSkgewogICAgICAgIHByaW50KCdSZXZva2luZyBTeXN0ZW0uJyArIHBlcm1pc3Npb24gKyAnIGZyb206ICcgKyB1c2VybmFtZSkKICAgICAgICBjb25uZWN0aW9uLnNlY3VyaXR5T3BlcmF0aW9ucygpLnJldm9rZVN5c3RlbVBlcm1pc3Npb24odXNlcm5hbWUsIHBlcm1pc3Npb24pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpZiAoc3lzUGVybWlzc2lvbkxpc3QuaW5kZXhPZihwZXJtaXNzaW9uLnRvU3RyaW5nKCkpICE9IC0xKSB7CiAgICAgICAgcHJpbnQoJ0dyYW50aW5nIFN5c3RlbS4nICsgcGVybWlzc2lvbiArICcgdG86ICcgKyB1c2VybmFtZSkKICAgICAgICBjb25uZWN0aW9uLnNlY3VyaXR5T3BlcmF0aW9ucygpLmdyYW50U3lzdGVtUGVybWlzc2lvbih1c2VybmFtZSwgcGVybWlzc2lvbik7CiAgICAgIH0KICAgIH0KICB9CgogIGZvciAodmFyIHRhYmxlTmFtZSBpbiB0YWJsZVBlcm1pc3Npb25zKSB7CiAgICBpZiAoY29ubmVjdGlvbi50YWJsZU9wZXJhdGlvbnMoKS5leGlzdHModGFibGVOYW1lKSkgewogICAgICB2YXIgdGJsUGVybWlzc2lvbkxpc3QgPSB0YWJsZVBlcm1pc3Npb25zW3RhYmxlTmFtZV0uc3BsaXQoJywnKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbGxUYWJsZVBlcm1pc3Npb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHBlcm1pc3Npb24gPSBhbGxUYWJsZVBlcm1pc3Npb25zW2ldOwogICAgICAgIGlmIChjb25uZWN0aW9uLnNlY3VyaXR5T3BlcmF0aW9ucygpLmhhc1RhYmxlUGVybWlzc2lvbih1c2VybmFtZSwgdGFibGVOYW1lLCBwZXJtaXNzaW9uKSkgewogICAgICAgICAgaWYgKHJldm9rZUVuYWJsZWQgPT0gJ3RydWUnICYmIHRibFBlcm1pc3Npb25MaXN0LmluZGV4T2YocGVybWlzc2lvbi50b1N0cmluZygpKSA9PSAtMSkgewogICAgICAgICAgICBwcmludCgnUmV2b2tpbmcgVGFibGUuJyArIHBlcm1pc3Npb24gKyAnIG9uOiAnICsgdGFibGVOYW1lICsgJyBmcm9tOiAnICsgdXNlcm5hbWUpCiAgICAgICAgICAgIGNvbm5lY3Rpb24uc2VjdXJpdHlPcGVyYXRpb25zKCkucmV2b2tlVGFibGVQZXJtaXNzaW9uKHVzZXJuYW1lLCB0YWJsZU5hbWUsIHBlcm1pc3Npb24pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGJsUGVybWlzc2lvbkxpc3QuaW5kZXhPZihwZXJtaXNzaW9uLnRvU3RyaW5nKCkpICE9IC0xKSB7CiAgICAgICAgICAgIHByaW50KCdHcmFudGluZyBUYWJsZS4nICsgcGVybWlzc2lvbiArICcgb246ICcgKyB0YWJsZU5hbWUgKyAnIHRvOiAnICsgdXNlcm5hbWUpCiAgICAgICAgICAgIGNvbm5lY3Rpb24uc2VjdXJpdHlPcGVyYXRpb25zKCkuZ3JhbnRUYWJsZVBlcm1pc3Npb24odXNlcm5hbWUsIHRhYmxlTmFtZSwgcGVybWlzc2lvbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9CnByb2Nlc3NVc2VyKCJ0cmFjZXIiLCJ0cmFjZXIiLCIiLCJDUkVBVEVfVEFCTEUiLHsidHJhY2UiOiAiUkVBRCxXUklURSIsfSk7CgppZiAocmV2b2tlRW5hYmxlZCA9PSAndHJ1ZScpIHsKICB2YXIgZGVzaXJlZFVzZXJzID0gInRyYWNlciIuc3BsaXQoIiwiKTsKICB2YXIgZGJVc2VycyA9IGNvbm5lY3Rpb24uc2VjdXJpdHlPcGVyYXRpb25zKCkubGlzdExvY2FsVXNlcnMoKS50b0FycmF5KCk7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYlVzZXJzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGJVc2VyID0gZGJVc2Vyc1tpXTsKICAgIGlmIChkYlVzZXIgIT0gJ3Jvb3QnICYmIGRlc2lyZWRVc2Vycy5pbmRleE9mKGRiVXNlcikgPT0gLTEpIHsKICAgICAgcHJpbnQoJ0RlbGV0aW5nIHVzZXI6ICcgKyBkYlVzZXIpOwogICAgICBjb25uZWN0aW9uLnNlY3VyaXR5T3BlcmF0aW9ucygpLmRyb3BMb2NhbFVzZXIoZGJVc2VyKTsKICAgIH0KICB9Cn0=
  commands.txt: c2NyaXB0IC1lIGpzIC1mIC4vYWNjdW11bG8tdXNlci1tYW5hZ2VtZW50LmpzCmV4aXQ=
---
# Source: accumulo/charts/hdfs/templates/config.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: ConfigMap
metadata:
  name: my-accumulo-hdfs
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
data:
  core-site.xml: |-
    <?xml version="1.0" encoding="UTF-8"?>
    <?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
    <configuration>
      <property>
        <name>fs.defaultFS</name>
        <value>hdfs://my-accumulo-hdfs-namenode-0.my-accumulo-hdfs-namenodes:8020</value>
      </property>
    </configuration>

  hdfs-site.xml: |-
    <?xml version="1.0" encoding="UTF-8"?>
    <?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
    <configuration>
      <property>
        <name>dfs.namenode.name.dir</name>
        <value>/data0/dfs/name</value>
      </property>
      <property>
        <name>dfs.datanode.data.dir</name>
        <value>/data0/dfs/data</value>
      </property>
      <property>
        <name>dfs.datanode.synconclose</name>
        <value>true</value>
      </property>
      <property>
        <name>dfs.replication</name>
        <value>3</value>
      </property>
      <property>
        <name>hadoop.security.authorization</name>
        <value>true</value>
      </property>
      <property>
        <name>net.topology.script.file.name</name>
        <value>/scripts/resolve-rack.sh</value>
      </property>
      <property>
        <name>net.topology.script.number.args</name>
        <value>1</value>
      </property>
      <property>
        <name>dfs.namenode.rpc-address</name>
        <value>my-accumulo-hdfs-namenode-0.my-accumulo-hdfs-namenodes:8020</value>
      </property>
      <property>
        <name>dfs.namenode.rpc-bind-host</name>
        <value>0.0.0.0</value>
      </property>
      <property>
        <name>dfs.namenode.servicerpc-address</name>
        <value>my-accumulo-hdfs-namenode-0.my-accumulo-hdfs-namenodes:8021</value>
      </property>
      <property>
        <name>dfs.namenode.servicerpc-bind-host</name>
        <value>0.0.0.0</value>
      </property>
      <property>
        <name>dfs.namenode.lifeline.rpc-address</name>
        <value>my-accumulo-hdfs-namenode-0.my-accumulo-hdfs-namenodes:8022</value>
      </property>
      <property>
        <name>dfs.namenode.lifeline.rpc-bind-host</name>
        <value>0.0.0.0</value>
      </property>
      <property>
        <name>dfs.namenode.http-address</name>
        <value>0.0.0.0:9870</value>
      </property>
      <property>
        <name>dfs.namenode.https-address</name>
        <value>0.0.0.0:9871</value>
      </property>
      <property>
        <name>dfs.datanode.http.address</name>
        <value>0.0.0.0:9864</value>
      </property>
      <property>
        <name>dfs.datanode.https.address</name>
        <value>0.0.0.0:9865</value>
      </property>
      <property>
        <name>dfs.datanode.address</name>
        <value>0.0.0.0:9866</value>
      </property>
      <property>
        <name>dfs.datanode.ipc.address</name>
        <value>0.0.0.0:9867</value>
      </property>
    </configuration>

  hadoop-policy.xml: |-
    <?xml version="1.0"?>
    <?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
    <configuration>
      <property>
        <name>security.client.protocol.acl</name>
        <value>*</value>
        <description>ACL for ClientProtocol, which is used by user code
        via the DistributedFileSystem.
        The ACL is a comma-separated list of user and group names. The user and
        group list is separated by a blank. For e.g. "alice,bob users,wheel".
        A special value of "*" means all users are allowed.</description>
      </property>

      <property>
        <name>security.client.datanode.protocol.acl</name>
        <value>*</value>
        <description>ACL for ClientDatanodeProtocol, the client-to-datanode protocol
        for block recovery.
        The ACL is a comma-separated list of user and group names. The user and
        group list is separated by a blank. For e.g. "alice,bob users,wheel".
        A special value of "*" means all users are allowed.</description>
      </property>

      <property>
        <name>security.datanode.protocol.acl</name>
        <value>hadoop</value>
        <description>ACL for DatanodeProtocol, which is used by datanodes to
        communicate with the namenode.
        The ACL is a comma-separated list of user and group names. The user and
        group list is separated by a blank. For e.g. "alice,bob users,wheel".
        A special value of "*" means all users are allowed.</description>
      </property>

      <property>
        <name>security.inter.datanode.protocol.acl</name>
        <value>hadoop</value>
        <description>ACL for InterDatanodeProtocol, the inter-datanode protocol
        for updating generation timestamp.
        The ACL is a comma-separated list of user and group names. The user and
        group list is separated by a blank. For e.g. "alice,bob users,wheel".
        A special value of "*" means all users are allowed.</description>
      </property>

      <property>
        <name>security.namenode.protocol.acl</name>
        <value>hadoop</value>
        <description>ACL for NamenodeProtocol, the protocol used by the secondary
        namenode to communicate with the namenode.
        The ACL is a comma-separated list of user and group names. The user and
        group list is separated by a blank. For e.g. "alice,bob users,wheel".
        A special value of "*" means all users are allowed.</description>
      </property>

     <property>
        <name>security.admin.operations.protocol.acl</name>
        <value>hadoop</value>
        <description>ACL for AdminOperationsProtocol. Used for admin commands.
        The ACL is a comma-separated list of user and group names. The user and
        group list is separated by a blank. For e.g. "alice,bob users,wheel".
        A special value of "*" means all users are allowed.</description>
      </property>

      <property>
        <name>security.refresh.user.mappings.protocol.acl</name>
        <value>hadoop</value>
        <description>ACL for RefreshUserMappingsProtocol. Used to refresh
        users mappings. The ACL is a comma-separated list of user and
        group names. The user and group list is separated by a blank. For
        e.g. "alice,bob users,wheel".  A special value of "*" means all
        users are allowed.</description>
      </property>

      <property>
        <name>security.refresh.policy.protocol.acl</name>
        <value>hadoop</value>
        <description>ACL for RefreshAuthorizationPolicyProtocol, used by the
        dfsadmin and mradmin commands to refresh the security policy in-effect.
        The ACL is a comma-separated list of user and group names. The user and
        group list is separated by a blank. For e.g. "alice,bob users,wheel".
        A special value of "*" means all users are allowed.</description>
      </property>

      <property>
        <name>security.ha.service.protocol.acl</name>
        <value>hadoop</value>
        <description>ACL for HAService protocol used by HAAdmin to manage the
          active and stand-by states of namenode.</description>
      </property>

      <property>
        <name>security.zkfc.protocol.acl</name>
        <value>hadoop</value>
        <description>ACL for access to the ZK Failover Controller
        </description>
      </property>

      <property>
        <name>security.qjournal.service.protocol.acl</name>
        <value>hadoop</value>
        <description>ACL for QJournalProtocol, used by the NN to communicate with
        JNs when using the QuorumJournalManager for edit logs.</description>
      </property>

      <property>
        <name>security.interqjournal.service.protocol.acl</name>
        <value>hadoop</value>
        <description>ACL for InterQJournalProtocol, used by the JN to
        communicate with other JN
        </description>
      </property>

    </configuration>

  log4j.properties: |-
    # Define some default values that can be overridden by system properties
    hadoop.root.logger=INFO,console
    hadoop.log.dir=.
    hadoop.log.file=hadoop.log

    # Define the root logger to the system property "hadoop.root.logger"
    log4j.rootLogger=${hadoop.root.logger}, EventCounter
    # Logging Threshold
    log4j.threshold=ALL

    # Null Appender
    log4j.appender.NullAppender=org.apache.log4j.varia.NullAppender

    # Console Appender
    log4j.appender.console=org.apache.log4j.ConsoleAppender
    log4j.appender.console.target=System.err
    log4j.appender.console.layout=org.apache.log4j.PatternLayout
    log4j.appender.console.layout.ConversionPattern=%d{ISO8601} %p %c{2}: %m%n

    # HDFS block state change log from block manager
    # Uncomment the following to log normal block state change
    # messages from BlockManager in NameNode.
    #log4j.logger.BlockStateChange=DEBUG

    # Security appender
    hadoop.security.logger=INFO,RFAS
    hadoop.security.log.maxfilesize=256MB
    hadoop.security.log.maxbackupindex=20
    log4j.category.SecurityLogger=${hadoop.security.logger}
    hadoop.security.log.file=security.audit
    log4j.appender.RFAS=org.apache.log4j.RollingFileAppender
    log4j.appender.RFAS.File=${hadoop.log.dir}/${hadoop.security.log.file}
    log4j.appender.RFAS.layout=org.apache.log4j.PatternLayout
    log4j.appender.RFAS.layout.ConversionPattern=%d{ISO8601} %p %c: %m%n
    log4j.appender.RFAS.MaxFileSize=${hadoop.security.log.maxfilesize}
    log4j.appender.RFAS.MaxBackupIndex=${hadoop.security.log.maxbackupindex}

    # hdfs audit logging
    hdfs.audit.logger=INFO,RFAAUDIT
    hdfs.audit.log.maxfilesize=256MB
    hdfs.audit.log.maxbackupindex=20
    log4j.logger.org.apache.hadoop.hdfs.server.namenode.FSNamesystem.audit=${hdfs.audit.logger}
    log4j.additivity.org.apache.hadoop.hdfs.server.namenode.FSNamesystem.audit=false
    log4j.appender.RFAAUDIT=org.apache.log4j.RollingFileAppender
    log4j.appender.RFAAUDIT.File=${hadoop.log.dir}/hdfs-audit.log
    log4j.appender.RFAAUDIT.layout=org.apache.log4j.PatternLayout
    log4j.appender.RFAAUDIT.layout.ConversionPattern=%d{ISO8601} %p %c{2}: %m%n
    log4j.appender.RFAAUDIT.MaxFileSize=${hdfs.audit.log.maxfilesize}
    log4j.appender.RFAAUDIT.MaxBackupIndex=${hdfs.audit.log.maxbackupindex}

    # NameNode metrics logging.
    # The default is to retain two namenode-metrics.log files up to 64MB each.
    namenode.metrics.logger=INFO,NNMETRICSRFA
    log4j.logger.NameNodeMetricsLog=${namenode.metrics.logger}
    log4j.additivity.NameNodeMetricsLog=false
    log4j.appender.NNMETRICSRFA=org.apache.log4j.RollingFileAppender
    log4j.appender.NNMETRICSRFA.File=${hadoop.log.dir}/namenode-metrics.log
    log4j.appender.NNMETRICSRFA.layout=org.apache.log4j.PatternLayout
    log4j.appender.NNMETRICSRFA.layout.ConversionPattern=%d{ISO8601} %m%n
    log4j.appender.NNMETRICSRFA.MaxBackupIndex=1
    log4j.appender.NNMETRICSRFA.MaxFileSize=64MB

    # DataNode metrics logging.
    # The default is to retain two datanode-metrics.log files up to 64MB each.
    datanode.metrics.logger=INFO,DNMETRICSRFA
    log4j.logger.DataNodeMetricsLog=${datanode.metrics.logger}
    log4j.additivity.DataNodeMetricsLog=false
    log4j.appender.DNMETRICSRFA=org.apache.log4j.RollingFileAppender
    log4j.appender.DNMETRICSRFA.File=${hadoop.log.dir}/datanode-metrics.log
    log4j.appender.DNMETRICSRFA.layout=org.apache.log4j.PatternLayout
    log4j.appender.DNMETRICSRFA.layout.ConversionPattern=%d{ISO8601} %m%n
    log4j.appender.DNMETRICSRFA.MaxBackupIndex=1
    log4j.appender.DNMETRICSRFA.MaxFileSize=64MB

    # Custom Logging levels
    #log4j.logger.org.apache.hadoop.hdfs.server.namenode.FSNamesystem.audit=DEBUG

    # AWS SDK & S3A FileSystem
    #log4j.logger.com.amazonaws=ERROR
    log4j.logger.com.amazonaws.http.AmazonHttpClient=ERROR
    #log4j.logger.org.apache.hadoop.fs.s3a.S3AFileSystem=WARN

    # Event Counter Appender
    # Sends counts of logging messages at different severity levels to Hadoop Metrics.
    log4j.appender.EventCounter=org.apache.hadoop.log.metrics.EventCounter

    # Log levels of third-party libraries
    log4j.logger.org.apache.commons.beanutils=WARN

    log4j.logger.org.apache.hadoop.security.ForwardAuthentication=DEBUG
---
# Source: accumulo/charts/hdfs/templates/rack-awareness-script.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-accumulo-hdfs-rack-awareness
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
data:
  resolve-rack.sh: |
    #!/bin/bash
    POD_IP=$1

    API_SERVER="kubernetes.default.svc"
    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
    NAMESPACE=$(cat /var/run/secrets/kubernetes.io/serviceaccount/namespace)
    CA_CERT="/var/run/secrets/kubernetes.io/serviceaccount/ca.crt"

    POD_RESPONSE=$(curl --cacert $CA_CERT --header "Authorization: Bearer $TOKEN" https://$API_SERVER/api/v1/namespaces/$NAMESPACE/pods?fieldSelector=status.podIP%3D$POD_IP)
    NODE_NAME=$(echo $POD_RESPONSE | jq -r '.items[0] | .spec.nodeName')

    NODE_RESPONSE=$(curl --cacert $CA_CERT  --header "Authorization: Bearer $TOKEN" https://$API_SERVER/api/v1/nodes/$NODE_NAME)
    NODE_ZONE=$(echo $NODE_RESPONSE | jq -r '.metadata.labels."topology.kubernetes.io/zone"')

    if [ -z "$NODE_ZONE" ] || [[ "$NODE_ZONE" == "null" ]]; then
      NODE_ZONE="default-rack"
    fi

    echo "/$NODE_ZONE"
---
# Source: accumulo/charts/zookeeper/templates/config-script.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-accumulo-zookeeper
  labels:
    app: zookeeper
    chart: zookeeper-2.1.5
    release: my-accumulo
    heritage: Helm
    component: server
data:
    ok: |
      #!/bin/sh
      zkServer.sh status

    ready: |
      #!/bin/sh
      echo ruok | nc 127.0.0.1 ${1:-2181}

    run: |
      #!/bin/bash

      set -a
      ROOT=$(echo /apache-zookeeper-*)

      ZK_USER=${ZK_USER:-"zookeeper"}
      ZK_LOG_LEVEL=${ZK_LOG_LEVEL:-"INFO"}
      ZK_DATA_DIR=${ZK_DATA_DIR:-"/data"}
      ZK_DATA_LOG_DIR=${ZK_DATA_LOG_DIR:-"/data/log"}
      ZK_CONF_DIR=${ZK_CONF_DIR:-"/conf"}
      ZK_CLIENT_PORT=${ZK_CLIENT_PORT:-2181}
      ZK_SERVER_PORT=${ZK_SERVER_PORT:-2888}
      ZK_ELECTION_PORT=${ZK_ELECTION_PORT:-3888}
      ZK_TICK_TIME=${ZK_TICK_TIME:-2000}
      ZK_INIT_LIMIT=${ZK_INIT_LIMIT:-10}
      ZK_SYNC_LIMIT=${ZK_SYNC_LIMIT:-5}
      ZK_HEAP_SIZE=${ZK_HEAP_SIZE:-2G}
      ZK_MAX_CLIENT_CNXNS=${ZK_MAX_CLIENT_CNXNS:-60}
      ZK_MIN_SESSION_TIMEOUT=${ZK_MIN_SESSION_TIMEOUT:- $((ZK_TICK_TIME*2))}
      ZK_MAX_SESSION_TIMEOUT=${ZK_MAX_SESSION_TIMEOUT:- $((ZK_TICK_TIME*20))}
      ZK_SNAP_RETAIN_COUNT=${ZK_SNAP_RETAIN_COUNT:-3}
      ZK_PURGE_INTERVAL=${ZK_PURGE_INTERVAL:-0}
      ID_FILE="$ZK_DATA_DIR/myid"
      ZK_CONFIG_FILE="$ZK_CONF_DIR/zoo.cfg"
      LOG4J_PROPERTIES="$ZK_CONF_DIR/log4j.properties"
      HOST=$(hostname)
      DOMAIN=`hostname -d`
      JVMFLAGS="-Xmx$ZK_HEAP_SIZE -Xms$ZK_HEAP_SIZE"

      APPJAR=$(echo $ROOT/*jar)
      CLASSPATH="${ROOT}/lib/*:${APPJAR}:${ZK_CONF_DIR}:"

      if [[ $HOST =~ (.*)-([0-9]+)$ ]]; then
          NAME=${BASH_REMATCH[1]}
          ORD=${BASH_REMATCH[2]}
          MY_ID=$((ORD+1))
      else
          echo "Failed to extract ordinal from hostname $HOST"
          exit 1
      fi

      mkdir -p $ZK_DATA_DIR
      mkdir -p $ZK_DATA_LOG_DIR
      echo $MY_ID >> $ID_FILE

      echo "clientPort=$ZK_CLIENT_PORT" >> $ZK_CONFIG_FILE
      echo "dataDir=$ZK_DATA_DIR" >> $ZK_CONFIG_FILE
      echo "dataLogDir=$ZK_DATA_LOG_DIR" >> $ZK_CONFIG_FILE
      echo "tickTime=$ZK_TICK_TIME" >> $ZK_CONFIG_FILE
      echo "initLimit=$ZK_INIT_LIMIT" >> $ZK_CONFIG_FILE
      echo "syncLimit=$ZK_SYNC_LIMIT" >> $ZK_CONFIG_FILE
      echo "maxClientCnxns=$ZK_MAX_CLIENT_CNXNS" >> $ZK_CONFIG_FILE
      echo "minSessionTimeout=$ZK_MIN_SESSION_TIMEOUT" >> $ZK_CONFIG_FILE
      echo "maxSessionTimeout=$ZK_MAX_SESSION_TIMEOUT" >> $ZK_CONFIG_FILE
      echo "autopurge.snapRetainCount=$ZK_SNAP_RETAIN_COUNT" >> $ZK_CONFIG_FILE
      echo "autopurge.purgeInterval=$ZK_PURGE_INTERVAL" >> $ZK_CONFIG_FILE
      echo "4lw.commands.whitelist=*" >> $ZK_CONFIG_FILE

      for (( i=1; i<=$ZK_REPLICAS; i++ ))
      do
          echo "server.$i=$NAME-$((i-1)).$DOMAIN:$ZK_SERVER_PORT:$ZK_ELECTION_PORT" >> $ZK_CONFIG_FILE
      done

      rm -f $LOG4J_PROPERTIES

      echo "zookeeper.root.logger=$ZK_LOG_LEVEL, CONSOLE" >> $LOG4J_PROPERTIES
      echo "zookeeper.console.threshold=$ZK_LOG_LEVEL" >> $LOG4J_PROPERTIES
      echo "zookeeper.log.threshold=$ZK_LOG_LEVEL" >> $LOG4J_PROPERTIES
      echo "zookeeper.log.dir=$ZK_DATA_LOG_DIR" >> $LOG4J_PROPERTIES
      echo "zookeeper.log.file=zookeeper.log" >> $LOG4J_PROPERTIES
      echo "zookeeper.log.maxfilesize=256MB" >> $LOG4J_PROPERTIES
      echo "zookeeper.log.maxbackupindex=10" >> $LOG4J_PROPERTIES
      echo "zookeeper.tracelog.dir=$ZK_DATA_LOG_DIR" >> $LOG4J_PROPERTIES
      echo "zookeeper.tracelog.file=zookeeper_trace.log" >> $LOG4J_PROPERTIES
      echo "log4j.rootLogger=\${zookeeper.root.logger}" >> $LOG4J_PROPERTIES
      echo "log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender" >> $LOG4J_PROPERTIES
      echo "log4j.appender.CONSOLE.Threshold=\${zookeeper.console.threshold}" >> $LOG4J_PROPERTIES
      echo "log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout" >> $LOG4J_PROPERTIES
      echo "log4j.appender.CONSOLE.layout.ConversionPattern=%d{ISO8601} [myid:%X{myid}] - %-5p [%t:%C{1}@%L] - %m%n" >> $LOG4J_PROPERTIES

      if [ -n "$JMXDISABLE" ]
      then
          MAIN=org.apache.zookeeper.server.quorum.QuorumPeerMain
      else
          MAIN="-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=$JMXPORT -Dcom.sun.management.jmxremote.authenticate=$JMXAUTH -Dcom.sun.management.jmxremote.ssl=$JMXSSL -Dzookeeper.jmx.log4j.disable=$JMXLOG4J org.apache.zookeeper.server.quorum.QuorumPeerMain"
      fi

      set -x
      exec java -cp "$CLASSPATH" $JVMFLAGS $MAIN $ZK_CONFIG_FILE
---
# Source: accumulo/charts/hdfs/templates/rack-awareness-rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: my-accumulo-hdfs-namenode
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: namenode
rules:
- apiGroups: [""]
  resources: ["nodes"]
  verbs: ["get"]
---
# Source: accumulo/charts/hdfs/templates/rack-awareness-rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: my-accumulo-hdfs-namenode
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: namenode
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: my-accumulo-hdfs-namenode
subjects:
- kind: ServiceAccount
  name: my-accumulo-hdfs-namenode
  namespace: default
---
# Source: accumulo/charts/hdfs/templates/rack-awareness-rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: my-accumulo-hdfs-namenode
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: namenode
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["list"]
---
# Source: accumulo/charts/hdfs/templates/rack-awareness-rbac.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: my-accumulo-hdfs-namenode
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: namenode
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: my-accumulo-hdfs-namenode
subjects:
- kind: ServiceAccount
  name: my-accumulo-hdfs-namenode
  namespace: default
---
# Source: accumulo/charts/hdfs/templates/datanodes-service.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: Service
metadata:
  name: my-accumulo-hdfs-datanodes
  labels:
    
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: datanode
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/component: datanode
  ports:
  - name: http
    protocol: TCP
    port: 80
    targetPort: http
---
# Source: accumulo/charts/hdfs/templates/namenode-service.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: Service
metadata:
  name: my-accumulo-hdfs-namenodes
  labels:
    
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: namenode
spec:
  type: ClusterIP
  clusterIP: None
  selector:
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/component: namenode
  ports:
  - name: http
    protocol: TCP
    port: 9870
    targetPort: http
  - name: client-rpc
    protocol: TCP
    port: 8020
    targetPort: client-rpc
  - name: service-rpc
    protocol: TCP
    port: 8021
    targetPort: service-rpc
  - name: lifeline-rpc
    protocol: TCP
    port: 8022
    targetPort: lifeline-rpc
---
# Source: accumulo/charts/zookeeper/templates/service-headless.yaml
apiVersion: v1
kind: Service
metadata:
  name: my-accumulo-zookeeper-headless
  labels:
    app: zookeeper
    chart: zookeeper-2.1.5
    release: my-accumulo
    heritage: Helm
spec:
  clusterIP: None
  ports:
    - name: client
      port: 2181
      targetPort: client
      protocol: TCP
    - name: election
      port: 3888
      targetPort: election
      protocol: TCP
    - name: server
      port: 2888
      targetPort: server
      protocol: TCP
  selector:
    app: zookeeper
    release: my-accumulo
---
# Source: accumulo/charts/zookeeper/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: my-accumulo-zookeeper
  labels:
    app: zookeeper
    chart: zookeeper-2.1.5
    release: my-accumulo
    heritage: Helm
spec:
  type: ClusterIP
  ports:
    - name: client
      port: 2181
      protocol: TCP
      targetPort: client
  selector:
    app: zookeeper
    release: my-accumulo
---
# Source: accumulo/templates/master/service.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: Service
metadata:
  name: my-accumulo-masters
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: master
spec:
  selector:
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/component: master
  type: ClusterIP
  clusterIP: None
  ports:
  - name: http
    protocol: TCP
    port: 80
    targetPort: 80
---
# Source: accumulo/templates/monitor/service.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: Service
metadata:
  name: my-accumulo-monitor
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: monitor
spec:
  selector:
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/component: monitor
  type: ClusterIP
  ports:
  - name: http
    protocol: TCP
    port: 80
    targetPort: http
---
# Source: accumulo/templates/tserver/service.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: Service
metadata:
  name: my-accumulo-tservers
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: tserver
spec:
  selector:
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/component: tserver
  type: ClusterIP
  clusterIP: None
  ports:
  - name: http
    protocol: TCP
    port: 80
    targetPort: 80
---
# Source: accumulo/charts/hdfs/templates/shell.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-accumulo-hdfs-shell
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: shell
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: hdfs
      app.kubernetes.io/instance: my-accumulo
      app.kubernetes.io/component: shell
  template:
    metadata:
      annotations:
        checksum/config: bd580f4fe4ac128d2997ef8136512dd2475efcd23b00b5a96b777b744732b07c
        checksum/secrets: 9b5b6b404c305948efd9c72c20460821b405c8c549f7669824a9842f4ef9aad4
      labels:
        helm.sh/chart: hdfs-2.2.1
        app.kubernetes.io/name: hdfs
        app.kubernetes.io/instance: my-accumulo
        app.kubernetes.io/version: "3.3.3"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: shell
    spec:
      containers:
      - name: shell
        image: gchq/hdfs:3.3.3
        imagePullPolicy: IfNotPresent
        command:
        - /bin/bash
        stdin: true
        tty: true
        env:
        - name: HADOOP_CONF_DIR
          value: /etc/hadoop/conf
        volumeMounts:
        - name: config
          mountPath: /etc/hadoop/conf
          readOnly: true
        - name: secrets
          mountPath: /etc/hadoop/secrets
          readOnly: true
        resources:
          {}
      volumes:
      - name: config
        configMap:
          name: my-accumulo-hdfs
          optional: false
      - name: secrets
        secret:
          secretName: my-accumulo-hdfs
          optional: false
---
# Source: accumulo/templates/gc/deployment.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-accumulo-gc
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: gc
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: accumulo
      app.kubernetes.io/instance: my-accumulo
      app.kubernetes.io/component: gc
  template:
    metadata:
      labels:
        helm.sh/chart: accumulo-2.2.1
        app.kubernetes.io/name: accumulo
        app.kubernetes.io/instance: my-accumulo
        app.kubernetes.io/version: "2.0.1"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: gc
      annotations:
        checksum/config: 38f0e0609892842280e748aecf9a70c58cfbbaf115fccc2582823d4c554a357d
    spec:
      containers:
      - name: accumulo-gc
        image: gchq/accumulo:2.0.1
        imagePullPolicy: IfNotPresent
        args:
        - gc
        env:
        - name: ACCUMULO_CONF_DIR
          value: /etc/accumulo/conf
        volumeMounts:
        - name: config
          mountPath: /etc/accumulo/conf
          readOnly: true
        resources:
          {}
      volumes:
      - name: config
        secret:
          secretName: my-accumulo-config
          optional: false
---
# Source: accumulo/templates/monitor/deployment.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-accumulo-monitor
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: monitor
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: accumulo
      app.kubernetes.io/instance: my-accumulo
      app.kubernetes.io/component: monitor
  template:
    metadata:
      labels:
        helm.sh/chart: accumulo-2.2.1
        app.kubernetes.io/name: accumulo
        app.kubernetes.io/instance: my-accumulo
        app.kubernetes.io/version: "2.0.1"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: monitor
      annotations:
        checksum/config: 38f0e0609892842280e748aecf9a70c58cfbbaf115fccc2582823d4c554a357d
    spec:
      containers:
      - name: accumulo-monitor
        image: gchq/accumulo:2.0.1
        imagePullPolicy: IfNotPresent
        args:
        - monitor
        env:
        - name: ACCUMULO_CONF_DIR
          value: /etc/accumulo/conf
        volumeMounts:
        - name: config
          mountPath: /etc/accumulo/conf
          readOnly: true
        ports:
        - name: http
          protocol: TCP
          containerPort: 9995
        # livenessProbe:
        #   httpGet:
        #     path: /
        #     port: http
        # readinessProbe:
        #   httpGet:
        #     path: /
        #     port: http
        resources:
          {}
      volumes:
      - name: config
        secret:
          secretName: my-accumulo-config
          optional: false
---
# Source: accumulo/charts/hdfs/templates/datanodes.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-accumulo-hdfs-datanode
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: datanode
spec:
  podManagementPolicy: Parallel
  replicas: 3
  serviceName: my-accumulo-hdfs-datanodes
  selector:
    matchLabels:
      app.kubernetes.io/name: hdfs
      app.kubernetes.io/instance: my-accumulo
      app.kubernetes.io/component: datanode
  volumeClaimTemplates:
  - metadata:
      name: data0
      labels:
        helm.sh/chart: hdfs-2.2.1
        app.kubernetes.io/name: hdfs
        app.kubernetes.io/instance: my-accumulo
        app.kubernetes.io/version: "3.3.3"
        app.kubernetes.io/managed-by: Helm
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 10Gi
  template:
    metadata:
      annotations:
        checksum/config: bd580f4fe4ac128d2997ef8136512dd2475efcd23b00b5a96b777b744732b07c
        checksum/secrets: 9b5b6b404c305948efd9c72c20460821b405c8c549f7669824a9842f4ef9aad4
      labels:
        helm.sh/chart: hdfs-2.2.1
        app.kubernetes.io/name: hdfs
        app.kubernetes.io/instance: my-accumulo
        app.kubernetes.io/version: "3.3.3"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: datanode
    spec:
      initContainers:
      - name: wait-for-namenode-startup
        image: alpine:3.10.2
        imagePullPolicy: IfNotPresent
        command: [
          "/bin/sh",
          "-c",
          'for i in $(seq 1 300); do nc -z -w3 my-accumulo-hdfs-namenode-0.my-accumulo-hdfs-namenodes:8021 && exit 0 || sleep 1; done; exit 1'
        ]
      containers:
      - name: datanode
        image: gchq/hdfs:3.3.3
        imagePullPolicy: IfNotPresent
        args:
        - datanode
        env:
        - name: HADOOP_CONF_DIR
          value: /etc/hadoop/conf
        volumeMounts:
        - name: config
          mountPath: /etc/hadoop/conf
          readOnly: true
        - name: secrets
          mountPath: /etc/hadoop/secrets
          readOnly: true
        - name: data0
          mountPath: /data0
        ports:
        - name: http
          containerPort: 9864
        - name: https
          containerPort: 9865
        - name: data-xfer
          containerPort: 9866
        - name: ipc
          containerPort: 9867
        livenessProbe:
          httpGet:
            scheme: HTTP
            port: http
            path: /
          initialDelaySeconds: 30
        readinessProbe:
          httpGet:
            scheme: HTTP
            port: http
            path: /
          initialDelaySeconds: 30
        resources:
          {}
      volumes:
      - name: config
        configMap:
          name: my-accumulo-hdfs
          optional: false
      - name: secrets
        secret:
          secretName: my-accumulo-hdfs
          optional: false
      securityContext:
        fsGroup: 1000
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
---
# Source: accumulo/charts/hdfs/templates/namenode.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-accumulo-hdfs-namenode
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: namenode
spec:
  podManagementPolicy: Parallel
  replicas: 1
  serviceName: my-accumulo-hdfs-namenodes
  selector:
    matchLabels:
      app.kubernetes.io/name: hdfs
      app.kubernetes.io/instance: my-accumulo
      app.kubernetes.io/component: namenode
  volumeClaimTemplates:
  - metadata:
      name: data0
      labels:
        helm.sh/chart: hdfs-2.2.1
        app.kubernetes.io/name: hdfs
        app.kubernetes.io/instance: my-accumulo
        app.kubernetes.io/version: "3.3.3"
        app.kubernetes.io/managed-by: Helm
    spec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 10Gi
  template:
    metadata:
      annotations:
        checksum/config: bd580f4fe4ac128d2997ef8136512dd2475efcd23b00b5a96b777b744732b07c
        checksum/secrets: 9b5b6b404c305948efd9c72c20460821b405c8c549f7669824a9842f4ef9aad4
      labels:
        helm.sh/chart: hdfs-2.2.1
        app.kubernetes.io/name: hdfs
        app.kubernetes.io/instance: my-accumulo
        app.kubernetes.io/version: "3.3.3"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: namenode
    spec:
      serviceAccountName: my-accumulo-hdfs-namenode
      containers:
      - name: namenode
        image: gchq/hdfs:3.3.3
        imagePullPolicy: IfNotPresent
        args:
        - namenode
        env:
        - name: HADOOP_CONF_DIR
          value: /etc/hadoop/conf
        volumeMounts:
        - name: config
          mountPath: /etc/hadoop/conf
          readOnly: true
        - name: secrets
          mountPath: /etc/hadoop/secrets
          readOnly: true
        - name: rack-awareness
          mountPath: /scripts/resolve-rack.sh
          subPath: resolve-rack.sh
        - name: data0
          mountPath: /data0
        ports:
        - name: http
          containerPort: 9870
        - name: https
          containerPort: 9871
        - name: client-rpc
          containerPort: 8020
        - name: service-rpc
          containerPort: 8021
        - name: lifeline-rpc
          containerPort: 8022
        livenessProbe:
          exec:
            command:
            - /bin/bash
            - -c
            - hdfs dfsadmin -fs hdfs://localhost -safemode get
          initialDelaySeconds: 30
          periodSeconds: 30
          timeoutSeconds: 30
          successThreshold: 1
          failureThreshold: 2
        resources:
          {}
      volumes:
      - name: config
        configMap:
          name: my-accumulo-hdfs
          optional: false
      - name: secrets
        secret:
          secretName: my-accumulo-hdfs
          optional: false
      - name: rack-awareness
        configMap:
          name: my-accumulo-hdfs-rack-awareness
          defaultMode: 0755
      securityContext:
        fsGroup: 1000
        runAsGroup: 1000
        runAsNonRoot: true
        runAsUser: 1000
---
# Source: accumulo/charts/zookeeper/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-accumulo-zookeeper
  labels:
    app: zookeeper
    chart: zookeeper-2.1.5
    release: my-accumulo
    heritage: Helm
    component: server
spec:
  serviceName: my-accumulo-zookeeper-headless
  replicas: 1
  selector:
    matchLabels:
      app: zookeeper
      release: my-accumulo
      component: server
  updateStrategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        app: zookeeper
        release: my-accumulo
        component: server
    spec:
      terminationGracePeriodSeconds: 1800
      securityContext:
        fsGroup: 1000
        runAsUser: 1000
      containers:

        - name: zookeeper
          image: "zookeeper:3.5.5"
          imagePullPolicy: IfNotPresent
          command: 
             - "/bin/bash"
             - "-xec"
             - "/config-scripts/run"
          ports:
            - name: client
              containerPort: 2181
              protocol: TCP
            - name: election
              containerPort: 3888
              protocol: TCP
            - name: server
              containerPort: 2888
              protocol: TCP
          livenessProbe:
            exec:
              command:
                - sh
                - /config-scripts/ok
            initialDelaySeconds: 20
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 2
            successThreshold: 1
          readinessProbe:
            exec:
              command:
                - sh
                - /config-scripts/ready
            initialDelaySeconds: 20
            periodSeconds: 30
            timeoutSeconds: 5
            failureThreshold: 2
            successThreshold: 1
          env:
            - name: ZK_REPLICAS
              value: "1"
            - name: JMXAUTH
              value: "false"
            - name: JMXDISABLE
              value: "false"
            - name: JMXPORT
              value: "1099"
            - name: JMXSSL
              value: "false"
            - name: ZK_SYNC_LIMIT
              value: "10"
            - name: ZK_TICK_TIME
              value: "2000"
            - name: ZOO_AUTOPURGE_PURGEINTERVAL
              value: "0"
            - name: ZOO_AUTOPURGE_SNAPRETAINCOUNT
              value: "3"
            - name: ZOO_INIT_LIMIT
              value: "5"
            - name: ZOO_MAX_CLIENT_CNXNS
              value: "60"
            - name: ZOO_PORT
              value: "2181"
            - name: ZOO_STANDALONE_ENABLED
              value: "false"
            - name: ZOO_TICK_TIME
              value: "2000"
          resources:
            {}
          volumeMounts:
            - name: data
              mountPath: /data
            - name: config
              mountPath: /config-scripts
      volumes:
        - name: config
          configMap:
            name: my-accumulo-zookeeper
            defaultMode: 0555
  volumeClaimTemplates:
    - metadata:
        name: data
      spec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: "5Gi"
---
# Source: accumulo/templates/master/statefulset.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-accumulo-masters
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: master
spec:
  podManagementPolicy: Parallel
  replicas: 1
  serviceName: my-accumulo-masters
  selector:
    matchLabels:
      app.kubernetes.io/name: accumulo
      app.kubernetes.io/instance: my-accumulo
      app.kubernetes.io/component: master
  template:
    metadata:
      labels:
        helm.sh/chart: accumulo-2.2.1
        app.kubernetes.io/name: accumulo
        app.kubernetes.io/instance: my-accumulo
        app.kubernetes.io/version: "2.0.1"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: master
      annotations:
        checksum/config: 38f0e0609892842280e748aecf9a70c58cfbbaf115fccc2582823d4c554a357d
    spec:
      containers:
      - name: accumulo-master
        image: gchq/accumulo:2.0.1
        imagePullPolicy: IfNotPresent
        args:
        - master
        env:
        - name: ACCUMULO_CONF_DIR
          value: /etc/accumulo/conf
        - name: ACCUMULO_INSTANCE_NAME
          value: accumulo
        volumeMounts:
        - name: config
          mountPath: /etc/accumulo/conf
          readOnly: true
        resources:
          {}
        livenessProbe:
          httpGet:
            path: /
            port: 9999
          initialDelaySeconds: 30
          periodSeconds: 30
          timeoutSeconds: 30
          successThreshold: 1
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /
            port: 9999
          initialDelaySeconds: 30
          periodSeconds: 5
      volumes:
      - name: config
        secret:
          secretName: my-accumulo-config
          optional: false
---
# Source: accumulo/templates/tserver/statefulset.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: my-accumulo-tservers
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: tserver
spec:
  podManagementPolicy: Parallel
  replicas: 3
  serviceName: my-accumulo-tservers
  selector:
    matchLabels:
      app.kubernetes.io/name: accumulo
      app.kubernetes.io/instance: my-accumulo
      app.kubernetes.io/component: tserver
  template:
    metadata:
      labels:
        helm.sh/chart: accumulo-2.2.1
        app.kubernetes.io/name: accumulo
        app.kubernetes.io/instance: my-accumulo
        app.kubernetes.io/version: "2.0.1"
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/component: tserver
      annotations:
        checksum/config: 38f0e0609892842280e748aecf9a70c58cfbbaf115fccc2582823d4c554a357d
    spec:
      containers:
      - name: accumulo-tserver
        image: gchq/accumulo:2.0.1
        imagePullPolicy: IfNotPresent
        args:
        - tserver
        env:
        - name: ACCUMULO_CONF_DIR
          value: /etc/accumulo/conf
        volumeMounts:
        - name: config
          mountPath: /etc/accumulo/conf
          readOnly: true
        resources:
          {}
      volumes:
      - name: config
        secret:
          secretName: my-accumulo-config
          optional: false
---
# Source: accumulo/charts/hdfs/templates/ingress.yaml
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: my-accumulo-hdfs
  labels:
    
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: namenode
  annotations:
    traefik.ingress.kubernetes.io/rule-type: PathPrefixStrip
spec:
  rules:
  - http:
      paths:
      - path: /hdfs/(.*)
        backend:
          serviceName: my-accumulo-hdfs-namenodes
          servicePort: 9870
---
# Source: accumulo/templates/monitor/ingress.yaml
apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: my-accumulo-monitor
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: monitor
  annotations:
    traefik.ingress.kubernetes.io/rule-type: PathPrefixStrip
spec:
  rules:
  - http:
      paths:
      - path: /accumulo/(.*)
        backend:
          serviceName: my-accumulo-monitor
          servicePort: http
---
# Source: accumulo/charts/hdfs/templates/post-install-cmds.yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-accumulo-hdfs-post-install-cmds
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: hook-succeeded
    helm.sh/hook-weight: "10"
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: hook
spec:
  restartPolicy: OnFailure
  containers:
  - name: cmds
    image: gchq/hdfs:3.3.3
    imagePullPolicy: IfNotPresent
    command: ["/bin/bash", "-c", "until hadoop fs -ls / >/dev/null 2>&1 || [ $(( ATTEMPTS++ )) -gt 300 ]; do echo \"$(date) - Waiting for HDFS instance to be ready...\" && sleep 10; done && hadoop fs -mkdir -p /accumulo && hadoop fs -chown accumulo /accumulo && hadoop fs -chmod 700 /accumulo && hadoop fs -ls /"]
    env:
    - name: HADOOP_CONF_DIR
      value: /etc/hadoop/conf
    volumeMounts:
    - name: config
      mountPath: /etc/hadoop/conf
      readOnly: true
  volumes:
  - name: config
    configMap:
      name: my-accumulo-hdfs
      optional: false
---
# Source: accumulo/charts/hdfs/templates/tests/auth-test.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: Pod
metadata:
  name: my-accumulo-hdfs-auth-test
  annotations:
    helm.sh/hook: test
    helm.sh/hook-delete-policy: hook-succeeded
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: test
spec:
  restartPolicy: Never
  containers:
  - name: test
    image: gchq/hdfs:3.3.3
    imagePullPolicy: IfNotPresent
    command: ["/bin/sh", "-c", "hadoop fs -put -f /opt/hadoop/LICENSE.txt / && hadoop fs -ls / && hadoop fs -rm /LICENSE.txt; rc=$?; echo $rc; [ $rc = 0 ]"]
    env:
    - name: HADOOP_CONF_DIR
      value: /etc/hadoop/conf
    volumeMounts:
    - name: config
      mountPath: /etc/hadoop/conf
      readOnly: true
  volumes:
  - name: config
    configMap:
      name: my-accumulo-hdfs
      optional: false
---
# Source: accumulo/charts/hdfs/templates/tests/rack-awareness-test.yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-accumulo-hdfs-rack-awareness-test
  annotations:
    helm.sh/hook: test
    helm.sh/hook-delete-policy: hook-succeeded
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: test
spec:
  restartPolicy: Never
  containers:
  - name: test
    image: gchq/hdfs:3.3.3
    imagePullPolicy: IfNotPresent
    command: ["/bin/sh", "-c", "hdfs dfsadmin -printTopology | grep Rack: | grep -v /default-rack"]
    env:
    - name: HADOOP_CONF_DIR
      value: /etc/hadoop/conf
    volumeMounts:
    - name: config
      mountPath: /etc/hadoop/conf
      readOnly: true
  volumes:
  - name: config
    configMap:
      name: my-accumulo-hdfs
      optional: false
---
# Source: accumulo/charts/hdfs/templates/tests/webhdfs-test.yaml
# Copyright 2020 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: Pod
metadata:
  name: my-accumulo-hdfs-webhdfs-test
  annotations:
    helm.sh/hook: test
    helm.sh/hook-delete-policy: hook-succeeded
  labels:
    helm.sh/chart: hdfs-2.2.1
    app.kubernetes.io/name: hdfs
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "3.3.3"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: test
spec:
  restartPolicy: Never
  containers:
  - name: test
    image: alpine:3.10.2
    imagePullPolicy: IfNotPresent
    command: ["/bin/sh", "-c", "apk update && apk add curl && statusCode=$(curl -f -s -o /dev/null -w \"%{http_code}\" http://my-accumulo-hdfs-namenodes:9870/webhdfs/v1?op=LISTSTATUS) && echo \"${statusCode}\" && [ \"${statusCode}\" = \"200\" ]"]
---
# Source: accumulo/templates/post-install-cmds/hook.yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-accumulo-post-install-cmds
  annotations:
    helm.sh/hook: post-install,post-upgrade
    helm.sh/hook-delete-policy: hook-succeeded
    helm.sh/hook-weight: "20"
  labels:
    helm.sh/chart: accumulo-2.2.1
    app.kubernetes.io/name: accumulo
    app.kubernetes.io/instance: my-accumulo
    app.kubernetes.io/version: "2.0.1"
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/component: hook
spec:
  restartPolicy: Never
  containers:
  - name: cmds
    image: gchq/accumulo:2.0.1
    imagePullPolicy: IfNotPresent
    command: ["/bin/bash", "/cmds/run.sh"]
    env:
    - name: ACCUMULO_CONF_DIR
      value: /etc/accumulo/conf
    volumeMounts:
    - name: config
      mountPath: /etc/accumulo/conf
      readOnly: true
    - name: cmds
      mountPath: /cmds
      readOnly: true
    resources:
      {}
  volumes:
  - name: config
    secret:
      secretName: my-accumulo-config
      optional: false
  - name: cmds
    secret:
      secretName: my-accumulo-cmds
      optional: false
